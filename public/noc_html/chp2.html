<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<title>Document</title>
	<link rel="stylesheet" href="stylesheets/docco.css">
	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
	<script type="text/javascript" src="javascripts/codeprocessing.js"></script>
	<script type="text/javascript" src="processingjs/processing.js"></script>
	<link rel="stylesheet" href="stylesheets/html.css" type="text/css">
</head>
<body>
	<div id="container">
		<h1 id="the-nature-of-code">The Nature of Code</h1><h2 id="chapter-2-forces">Chapter 2.  Forces</h2>
<blockquote>
	<span class="quote_start">“</span>“Don’t underestimate the Force.”
  —Darth Vader
	
</blockquote><p>In the final example of Chapter 1, we saw how we could calculate a dynamic acceleration based on a vector pointing from a circle on the screen to the mouse location.   The resulting motion resembled a magnetic attraction between circle and mouse, as if some <em>force</em> were pulling the circle in towards the mouse.  In this chapter we will formalize our understanding of the concept of a <strong><em>force</em></strong> and its relationship to <strong><em>acceleration</em></strong>.    Our goal, by the end of this chapter, is to understand how to make multiple objects move around the screen and respond to a variety of environmental forces.</p>
<h2 id="21-forces-and-newtons-laws-of-motion">2.1 Forces and Newton’s Laws of Motion</h2>
<p>Before we begin examining the practical realities of simulating forces in code, let’s take a conceptual look at what it means to be a <strong><em>force</em></strong> in the real world.   Just as with the word “vector”, “force” is often commonly used to mean a variety of things.  It can be used to indicate a powerful intensity, as in “She pushed the boulder with great force” or “He spoke forcefully.”   The definition of force that we care about is much more formal and comes from Isaac Newton’s laws of motion:</p>
<p><strong><em>Force is a vector that causes an object with mass to accelerate.</em></strong></p>
<p>The good news here is that we recognize the first part of the definition—“a force is a vector.” Thank goodness we just spent a whole chapter learning what a vector is and how to program with PVectors!</p>
<p>Let’s look at Newton’s three laws in relation to the concept of a force.</p>
<h3 id="newtons-first-law">Newton’s First Law</h3><p>Newton’s first law is commonly stated as:</p>
<div class="note">
	<p><em>An object at rest stays at rest and an object in motion stays in motion.</em></p>

</div><p>However, this is missing an important element related to forces and so we could expand it by stating:</p>
<div class="note">
	<p><em>An object at rest stays at rest and an object in motion stays in motion at a constant speed and direction unless acted upon by an unbalanced force.</em></p>

</div><p>By the time Newton came along, the prevailing theory of motion—formulated by Aristotle—was nearly two thousand years old. It stated that if an object is moving, some sort of “force” is required to keep it moving.   Unless that moving thing is being pushed or pulled, it will simply slow down or stop.   Right?</p>
<p>This, of course, is not true.   In the absence of any forces, no force is required to keep an object moving.  An object (such as a ball) tossed in the earth’s atmosphere slows down because of air resistance (a force).    An object’s velocity will only remain constant in the absence of any forces or if the forces that act on it <em>cancel each other out</em>, i.e. the net force adds up to zero.  This is often referred to as <strong><em>equilibrium</em></strong>.  The falling ball will reach a terminal velocity (that stays constant) once the force of air resistance equals the force of gravity.</p>
<div class="image-container half-width-right" >
	
	<img src="imgs/chapter02/ch2_01.png" alt="Figure 2.1: The pendulum doesn't move because all the forces cancel each other out (add up to a net force of zero.)" />
	
	<p class="caption">Figure 2.1: The pendulum doesn't move because all the forces cancel each other out (add up to a net force of zero.)</p>
</div>
<p>In our Processing world, we could restate Newton’s first law as follows:</p>
<div class="note">
	<p><em>An object’s PVector <strong>velocity</strong> will remain constant if it is in a state of equilibrium.</em></p>

</div><p>Skipping Newton’s second law (arguably the most important law for our purposes) for a moment, let’s move on to the third law.</p>
<h3 id="newtons-third-law">Newton’s Third Law</h3><p>This law is often stated as:</p>
<div class="note">
	<p><strong><em>For every action there is an equal and opposite reaction.</em></strong></p>

</div><p>This law frequently causes some confusion in the way that it is stated.   For one, it sounds like one force causes another.   Yes, if you push someone, that someone may <em>actively</em> decide to push you back.  But this is not the action and reaction we are talking about with Newton’s third law.</p>
<p>Let’s say you push against a wall.  The wall doesn’t actively decide to push back on you.   There is no “origin” force.   Your push simply includes both forces, referred to as an “action/reaction pair.”</p>
<p>A better way of stating the law might be:</p>
<div class="note">
	<p><em>Forces always occur in pairs.  The two forces are of equal strength, but in opposite directions.</em></p>

</div><p>Now, this still causes confusion because it sounds like these forces would always cancel each other out.   This is not the case.  Remember, the forces act on different objects.  And just because the two forces are equal, it doesn’t mean that the <em>movements</em> are equal (or that the objects will stop moving).</p>
<p>Try pushing on a stationary truck.  Although the truck is far more powerful than you, a stationary truck will never overpower you and send you flying backwards.  The force you exert on it is equal and opposite to the force exerted on your hand.   The outcome depends on a variety of other factors.  If the truck is a small truck on an icy downhill, you’ll probably be able to get it to move.  On the other hand, if it’s a very large truck on a dirt road and you push hard enough (maybe even take a running start) you could injure your hand.</p>
<p>And if you are wearing roller skates when you push on that truck?</p>
<div class="image-container half-width" >
	
	<img src="imgs/chapter02/ch2_02.png" alt="Figure 2.2" />
	
	<p class="caption">Figure 2.2</p>
</div>
<p>￼
<span class="notetoself">[REDO DIAGRAM AS TRUCK]</span></p>
<p>You’ll accelerate away from the truck sliding along the road while the truck stays put.   Why do you slide but not the truck?  For one, the truck has a much larger mass (which we’ll get into with Newton’s second law) and there are other forces at work too, namely the friction of the truck’s tires and your roller skates against the road.</p>
<h3 id="newtons-third-law-as-seen-through-the-eyes-of-processing">Newton’s Third Law as seen through the eyes of Processing</h3><p>If we calculate a <span class="klass">PVector</span> <span class="var">f</span> that is a force of object A on object B, we must also apply the force <span class="var">f</span> (or <span class="function">PVector.mult(f,-1);</span>) that B exerts on object A.</p>
<p>We’ll see that in the world of Processing programming we don’t always have to stay true to the above.  Sometimes, such as in the case of gravitational attraction between bodies ([notetoself]see ex. 2.x on p.XX), we’ll want to model equal and opposite forces.  Other times, such as when we’re simply saying, “Hey, there’s some wind in the environment,” we’re not going to bother to model the force that a body exerts back on the air.  In fact, we’re not modeling the air at all!  Remember, we are simply taking inspiration from the physics of the natural world and not simulating everything with perfect precision.</p>
<h2 id="22-forces-and-processingnewtons-second-law-as-a-function">2.2 Forces and Processing—Newton’s Second Law as a Function</h2>
<p>And here we are at the most important law for the Processing programmer.</p>
<h3 id="newtons-second-law">Newton’s Second Law</h3><p><span class="var">F</span> = <span class="var">M</span> <strong>[var]*A</strong>
<span class="notetoself">need to fix up all these formulas, also vector notation for them</span></p>
<p>Force equals mass times acceleration.</p>
<p>Why is this the most important law for us?  Well, let’s write this a different way.</p>
<p><span class="var">A</span> = <span class="var">F</span> / <span class="var">M</span></p>
<p>Acceleration is directly proportional to force and inversely proportional to mass.  This means that if you get pushed, the harder you are pushed, the faster you’ll move (accelerate).  The bigger you are, the slower you’ll move.</p>
<div class="note">
	<h4 id="weight-vs-mass">Weight vs. Mass</h4><div class="list">
	
	<ul>
		
			<li><p>
The <strong>mass</strong> of an object is a measure of the amount of matter in the object (measured in kilograms).
</p>
</li>
		
			<li><p><strong>Weight</strong>, though often mistaken for mass, is technically the force of gravity on an object. From Newton’s second law, we can calculate it as mass times the acceleration of gravity (<span class="var">w</span> = <span class="var">m</span> * <span class="var">g</span>). Weight is measured in newtons.
</p>
</li>
		
			<li><p><strong>Density</strong> is is defined as the amount of mass per unit of volume (grams per cubic centimeter, for example).
</p>
</li>
		
	</ul>
</div><p>Note that an object that has a mass of one kilogram on earth would have a mass of one kilogram on the moon. However, it would weigh only one-sixth as much.</p>

</div><p>Now, in the world of Processing, what is mass anyway?  Aren’t we dealing with pixels?  To start in a simpler place, let’s say that in our pretend pixel world, all of our objects have a mass equal to 1.  <span class="var">F</span>/ 1 = <span class="var">F</span>.  And so:</p>
<p><span class="var">A</span> = <span class="var">F</span></p>
<p>The acceleration of an object is equal to force.  This is great news.  After all, we saw in Chapter 1 that acceleration was the key to the controlling the movement of our objects on screen.  Location is adjusted by velocity, and velocity by acceleration.  Acceleration was where it all began.  Now we learn that <strong>force</strong> is truly where it all begins.</p>
<p>Let’s say we have a class called Mover, with location, velocity, and acceleration.</p>











<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>	
  <textarea>class Mover {
  PVector location;
  PVector velocity;
  PVector acceleration;
}</textarea>
  
  
  
  <div class="code-block">
  <div class="code-comment-pair">
    
    <span class="code-comment"></span>
    <code><pre><span class='one-line'><span class="kd">class</span> <span class="nc">Mover</span> <span class="o">{</span></span>
<span class='one-line'>  <span class="n">PVector</span> <span class="n">location</span><span class="o">;</span></span>
<span class='one-line'>  <span class="n">PVector</span> <span class="n">velocity</span><span class="o">;</span></span>
<span class='one-line'>  <span class="n">PVector</span> <span class="n">acceleration</span><span class="o">;</span></span>
<span class='one-line'><span class="o">}</span></span></pre></code>
  </div>

</div>
</div>
<p>Now our goal is to be able to add forces to this object, perhaps saying:</p>











<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>	
  <textarea>mover.applyForce(wind);</textarea>
  
  
  
  <div class="code-block">
  <div class="code-comment-pair">
    
    <span class="code-comment"></span>
    <code><pre><span class='one-line'><span class="n">mover</span><span class="o">.</span><span class="na">applyForce</span><span class="o">(</span><span class="n">wind</span><span class="o">);</span></span></pre></code>
  </div>

</div>
</div>
<p>or:</p>











<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>	
  <textarea>mover.applyForce(gravity);</textarea>
  
  
  
  <div class="code-block">
  <div class="code-comment-pair">
    
    <span class="code-comment"></span>
    <code><pre><span class='one-line'><span class="n">mover</span><span class="o">.</span><span class="na">applyForce</span><span class="o">(</span><span class="n">gravity</span><span class="o">);</span></span></pre></code>
  </div>

</div>
</div>
<p>where wind and gravity are PVectors.  According to Newton’s second law, we could implement this function as follows.</p>











<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>	
  <textarea>  void applyForce(PVector force) {
    // Newton’s second law at its simplest.
    acceleration = force;
  }</textarea>
  
  
  
  <div class="code-block">
  <div class="code-comment-pair">
    
    <span class="code-comment"></span>
    <code><pre><span class='one-line'>  <span class="kt">void</span> <span class="nf">applyForce</span><span class="o">(</span><span class="n">PVector</span> <span class="n">force</span><span class="o">)</span> <span class="o">{</span></span></pre></code>
  </div>
<div class="code-comment-pair">
    <div class="code-comment-line"></div>
    <span class="code-comment">Newton’s second law at its simplest.</span>
    <code><pre><span class='one-line'>    <span class="n">acceleration</span> <span class="o">=</span> <span class="n">force</span><span class="o">;</span></span>
<span class='one-line'>  <span class="o">}</span></span></pre></code>
  </div>

</div>
</div>
<h2 id="23-force-accumulation">2.3 Force Accumulation</h2>
<p>This looks pretty good.  After all, it’s a literal translation of Newton’s second law (without mass): <strong><em>Acceleration = Force</em></strong>.   Nevertheless, there’s a pretty big problem here.  Let’s return to what we are trying to accomplish: creating a moving object on the screen that responds to wind and gravity.</p>











<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>	
  <textarea>mover.applyForce(wind);
mover.applyForce(gravity);
mover.update();
mover.display();</textarea>
  
  
  
  <div class="code-block">
  <div class="code-comment-pair">
    
    <span class="code-comment"></span>
    <code><pre><span class='one-line'><span class="n">mover</span><span class="o">.</span><span class="na">applyForce</span><span class="o">(</span><span class="n">wind</span><span class="o">);</span></span>
<span class='one-line'><span class="n">mover</span><span class="o">.</span><span class="na">applyForce</span><span class="o">(</span><span class="n">gravity</span><span class="o">);</span></span>
<span class='one-line'><span class="n">mover</span><span class="o">.</span><span class="na">update</span><span class="o">();</span></span>
<span class='one-line'><span class="n">mover</span><span class="o">.</span><span class="na">display</span><span class="o">();</span></span></pre></code>
  </div>

</div>
</div>
<p>Ok, let’s <em>be</em> the computer for a moment.  First, we call <span class="function">applyForce()</span> with wind.  And so the Mover object’s acceleration is now set to the wind PVector.   Second, we call <span class="function">applyForce()</span> with gravity.  And so the Mover object’s acceleration is now set to the gravity PVector.    Third, we call <span class="function">update()</span>.  What happens in update?  Acceleration is added to velocity.</p>











<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>	
  <textarea>velocity.add(acceleration);</textarea>
  
  
  
  <div class="code-block">
  <div class="code-comment-pair">
    
    <span class="code-comment"></span>
    <code><pre><span class='one-line'><span class="n">velocity</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">acceleration</span><span class="o">);</span></span></pre></code>
  </div>

</div>
</div>
<p>We’re not going to see any <em>error</em> in Processing, but zoinks!  We’ve got a major problem.  What is the value of acceleration when it is added to velocity?  It is equal to the gravity force.  Wind has been left out!  If we call <span class="function">applyForce()</span> more than once, it overrides each previous call.   How are we going to handle more than one force?</p>
<p>The answer is through a process known as <strong><em>force accumulation</em></strong>.  It’s actually very simple; all we need to do is add all of the forces together.  At any given moment, there might be one, two, six, twelve, or three hundred and three forces.  As long as our object knows how to accumulate them, it doesn’t matter how many forces act on it.</p>











<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>	
  <textarea> void applyForce(PVector force) {
  // Newton’s second law but with force accumulation.
  // We now add each force to acceleration, one at a time.
    acceleration.add(force);
 }</textarea>
  
  
  
  <div class="code-block">
  <div class="code-comment-pair">
    
    <span class="code-comment"></span>
    <code><pre><span class='one-line'> <span class="kt">void</span> <span class="nf">applyForce</span><span class="o">(</span><span class="n">PVector</span> <span class="n">force</span><span class="o">)</span> <span class="o">{</span></span></pre></code>
  </div>
<div class="code-comment-pair">
    <div class="code-comment-line"></div>
    <span class="code-comment">Newton’s second law but with force accumulation.
We now add each force to acceleration, one at a time.</span>
    <code><pre><span class='one-line'>    <span class="n">acceleration</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">force</span><span class="o">);</span></span>
<span class='one-line'> <span class="o">}</span></span></pre></code>
  </div>

</div>
</div>
<p>Now, we’re not finished just yet.  There is one more piece to force accumulation.  Since we’re adding all the forces together at any given moment, we have to make sure that we clear acceleration (i.e. set it to zero) before each time <span class="function">update()</span> is called.   Let’s think about wind for a moment.   Sometimes the wind is very strong, sometimes it’s weak, and sometimes there’s no wind at all.   At any given moment, there might be a huge gust of wind, say, when the user holds down the mouse.</p>











<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>	
  <textarea>if (mousePressed) {
  PVector wind = new PVector(0.5,0);
  mover.applyForce(wind);
}</textarea>
  
  
  
  <div class="code-block">
  <div class="code-comment-pair">
    
    <span class="code-comment"></span>
    <code><pre><span class='one-line'><span class="k">if</span> <span class="o">(</span><span class="n">mousePressed</span><span class="o">)</span> <span class="o">{</span></span>
<span class='one-line'>  <span class="n">PVector</span> <span class="n">wind</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PVector</span><span class="o">(</span><span class="mf">0.5</span><span class="o">,</span><span class="mi">0</span><span class="o">);</span></span>
<span class='one-line'>  <span class="n">mover</span><span class="o">.</span><span class="na">applyForce</span><span class="o">(</span><span class="n">wind</span><span class="o">);</span></span>
<span class='one-line'><span class="o">}</span></span></pre></code>
  </div>

</div>
</div>
<p>When the user releases the mouse, the wind will stop and according to Newton’s first law, the object will continue to move at a constant velocity.   However, if we had forgotten to reset acceleration to zero, the gust of wind would still be in effect.  Even worse, it would add onto itself from the previous frame, since we are accumulating forces!    Acceleration, in our simulation, has no memory; it is simply calculated based on the environmental forces present at a moment in time.   This is different than, say, location, which must remember where the object was the previous frame in order to move properly to the next.</p>
<p>The easiest way to implement clearing the acceleration for each frame is to multiply the <span class="klass">PVector</span> by zero at the end of <span class="function">update()</span>.</p>











<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>	
  <textarea> void update() {
    velocity.add(acceleration);
    location.add(velocity);
    acceleration.mult(0);
 }</textarea>
  
  
  
  <div class="code-block">
  <div class="code-comment-pair">
    
    <span class="code-comment"></span>
    <code><pre><span class='one-line'> <span class="kt">void</span> <span class="nf">update</span><span class="o">()</span> <span class="o">{</span></span>
<span class='one-line'>    <span class="n">velocity</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">acceleration</span><span class="o">);</span></span>
<span class='one-line'>    <span class="n">location</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">velocity</span><span class="o">);</span></span>
<span class='one-line'>    <span class="n">acceleration</span><span class="o">.</span><span class="na">mult</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span></span>
<span class='one-line'> <span class="o">}</span></span></pre></code>
  </div>

</div>
</div>
<div class="example">
	<h3 id="exercise-21">Exercise 2.1</h3><p>Using forces, simulate a helium-filled balloon floating upward (and bouncing off the top of a window).  Can you add a wind force which changes over time, perhaps according to Perlin noise?</p>

</div><h2 id="24-dealing-with-mass">2.4 Dealing with Mass</h2>
<p>OK. We’ve got one tiny little addition to make before we are done with integrating forces into our Mover class and are ready to look at examples.  After all, Newton’s second law is really <span class="var">F</span> = <span class="var">M</span> * <span class="var">A</span>, not <span class="var">F</span> = <span class="var">A</span>.   Incorporating mass is as easy as adding an instance variable to our class, but we need to spend a little more time here because a slight complication will emerge.</p>
<p>First we just need to add mass.</p>











<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>	
  <textarea>class Mover {
  PVector location;
  PVector velocity;
  PVector acceleration;
  float mass;</textarea>
  
  
  
  <div class="code-block">
  <div class="code-comment-pair">
    
    <span class="code-comment"></span>
    <code><pre><span class='one-line'><span class="kd">class</span> <span class="nc">Mover</span> <span class="o">{</span></span>
<span class='one-line'>  <span class="n">PVector</span> <span class="n">location</span><span class="o">;</span></span>
<span class='one-line'>  <span class="n">PVector</span> <span class="n">velocity</span><span class="o">;</span></span>
<span class='one-line'>  <span class="n">PVector</span> <span class="n">acceleration</span><span class="o">;</span></span>
<span class='one-line'>  <span class="kt">float</span> <span class="n">mass</span><span class="o">;</span></span></pre></code>
  </div>

</div>
</div>
<div class="note">
	<h3 id="units-of-measurement">Units of Measurement</h3><p>Now that we are introducing mass it’s important to make a quick note about units of measurement.  In the real world, things are measured with specific units.  We say that two objects are three meters apart, the baseball is moving at a rate of ninety miles per hour, or this bowling ball has a mass of six kilograms.   As we’ll see later in this book, sometimes we will want to take real-world units into consideration.  However, in this chapter, we’re going to ignore them for the most part.  Our units of measurement are in pixels (“these two circles are one hundred pixels apart”) and frames of animation (“this circle is moving at a rate of two pixels per frame.”)   In the case of mass, there isn’t any unit of measurement for us to use.  We’re just going to make something up.  In this example, we’re arbitrarily picking the number ten.   There is no unit of measurement (you might enjoy inventing a unit of your own, like “1 moog” or “1 yurkle.”)  It should also be noted that, for demonstration purposes, we’ll tie mass to pixels (drawing, say, a circle with a radius of ten).  This will allow us to visualize the mass of an object.   In the real world, however, size does not definitely indicate mass. A small metal ball could have a much higher mass than a large balloon due to its higher density.</p>

</div><p>Mass is a scalar (float), not a vector, as it’s just one number describing the amount of matter in an object.  We could be fancy about things and compute the area of a shape as its mass, but it’s simpler to begin by saying, “Hey, the mass of this object is…um, I dunno…how about 10?”</p>











<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>	
  <textarea> Mover() {
    location = new PVector(random(width),random(height));
    velocity = new PVector(0,0);
    acceleration = new PVector(0,0);
    mass = 10.0;
  }</textarea>
  
  
  
  <div class="code-block">
  <div class="code-comment-pair">
    
    <span class="code-comment"></span>
    <code><pre><span class='one-line'> <span class="n">Mover</span><span class="o">()</span> <span class="o">{</span></span>
<span class='one-line'>    <span class="n">location</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PVector</span><span class="o">(</span><span class="n">random</span><span class="o">(</span><span class="n">width</span><span class="o">),</span><span class="n">random</span><span class="o">(</span><span class="n">height</span><span class="o">));</span></span>
<span class='one-line'>    <span class="n">velocity</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PVector</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span><span class="mi">0</span><span class="o">);</span></span>
<span class='one-line'>    <span class="n">acceleration</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PVector</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span><span class="mi">0</span><span class="o">);</span></span>
<span class='one-line'>    <span class="n">mass</span> <span class="o">=</span> <span class="mf">10.0</span><span class="o">;</span></span>
<span class='one-line'>  <span class="o">}</span></span></pre></code>
  </div>

</div>
</div>
<p>This isn’t so great since things only become interesting once we have objects with varying mass, but it’ll get us started.  Where does mass come in?  We use it while applying Newton’s second law to our object.</p>











<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>	
  <textarea> void applyForce(PVector force) {
   force.div(mass);
   // Newton’s second law (with force accumulation and mass).
   acceleration.add(force);
 }</textarea>
  
  
  
  <div class="code-block">
  <div class="code-comment-pair">
    
    <span class="code-comment"></span>
    <code><pre><span class='one-line'> <span class="kt">void</span> <span class="nf">applyForce</span><span class="o">(</span><span class="n">PVector</span> <span class="n">force</span><span class="o">)</span> <span class="o">{</span></span>
<span class='one-line'>   <span class="n">force</span><span class="o">.</span><span class="na">div</span><span class="o">(</span><span class="n">mass</span><span class="o">);</span></span></pre></code>
  </div>
<div class="code-comment-pair">
    <div class="code-comment-line"></div>
    <span class="code-comment">Newton’s second law (with force accumulation and mass).</span>
    <code><pre><span class='one-line'>   <span class="n">acceleration</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">force</span><span class="o">);</span></span>
<span class='one-line'> <span class="o">}</span></span></pre></code>
  </div>

</div>
</div>
<p>Yet again, even though our code looks quite reasonable, we have a fairly major problem here.  Consider the following scenario with two <em>Mover</em> objects, both being blown away by a wind force.</p>











<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>	
  <textarea>Mover m1 = new Mover();
Mover m2 = new Mover();

PVector wind = new PVector(1,0);

m1.applyForce(wind);
m2.applyForce(wind);</textarea>
  
  
  
  <div class="code-block">
  <div class="code-comment-pair">
    
    <span class="code-comment"></span>
    <code><pre><span class='one-line'><span class="n">Mover</span> <span class="n">m1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Mover</span><span class="o">();</span></span>
<span class='one-line'><span class="n">Mover</span> <span class="n">m2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Mover</span><span class="o">();</span></span>

<span class='one-line'><span class="n">PVector</span> <span class="n">wind</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PVector</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span><span class="mi">0</span><span class="o">);</span></span>

<span class='one-line'><span class="n">m1</span><span class="o">.</span><span class="na">applyForce</span><span class="o">(</span><span class="n">wind</span><span class="o">);</span></span>
<span class='one-line'><span class="n">m2</span><span class="o">.</span><span class="na">applyForce</span><span class="o">(</span><span class="n">wind</span><span class="o">);</span></span></pre></code>
  </div>

</div>
</div>
<p>Again, let’s <em>be</em> the computer.  Object <span class="var">m1</span> receives the wind force—(1,0)—divides it by mass (10) and adds it to acceleration.</p>
<p><span class="var">m1</span>:<br />
wind force is equal to:  (1,0)<br />
divided by mass = 10:    (0.1,0)</p>
<p>OK, moving onto object <span class="var">m2</span>.  It also receives the wind force—(1,0).  Wait.  Hold on a second.  What is the value of wind force?   Taking a closer look, the wind force is actually now—(0.1,0)!!   Do you remember this little tidbit about working with objects?  When you pass an object (in this case a <span class="klass">PVector</span>) into a function, you are passing a reference to that object.  It’s not a copy!  So if a function makes a change to that object (which, in this case, it does by dividing by mass) then that object is permanently changed!  But we don’t want <span class="var">m2</span> to receive a force divided by the mass of object <span class="var">m1</span>. We want it to receive that force in its original state—(1,0).  And so we must protect ourselves and make a copy of the PVector f before dividing it by mass.    Fortunately, the <span class="klass">PVector</span> class has a convenient method for making a copy—<span class="function">get()</span>.  <span class="function">get()</span> returns a new <span class="klass">PVector</span> object with the same data.  And so we can revise <span class="function">applyForce()</span> as follows:</p>











<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>	
  <textarea>void applyForce(PVector force) {
  // Making a copy of the PVector before using it!
  PVector f = force.get();
  f.div(mass);
  acceleration.add(f);
}</textarea>
  
  
  
  <div class="code-block">
  <div class="code-comment-pair">
    
    <span class="code-comment"></span>
    <code><pre><span class='one-line'><span class="kt">void</span> <span class="nf">applyForce</span><span class="o">(</span><span class="n">PVector</span> <span class="n">force</span><span class="o">)</span> <span class="o">{</span></span></pre></code>
  </div>
<div class="code-comment-pair">
    <div class="code-comment-line"></div>
    <span class="code-comment">Making a copy of the PVector before using it!</span>
    <code><pre><span class='one-line'>  <span class="n">PVector</span> <span class="n">f</span> <span class="o">=</span> <span class="n">force</span><span class="o">.</span><span class="na">get</span><span class="o">();</span></span>
<span class='one-line'>  <span class="n">f</span><span class="o">.</span><span class="na">div</span><span class="o">(</span><span class="n">mass</span><span class="o">);</span></span>
<span class='one-line'>  <span class="n">acceleration</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">f</span><span class="o">);</span></span>
<span class='one-line'><span class="o">}</span></span></pre></code>
  </div>

</div>
</div>
<p>There’s another way we could write the above function, using the static method <span class="function">div()</span>.   For help with this exercise, review static methods in Chapter 1 ([REF] see p. XXX).</p>
<div class="example">
	<h3 id="exercise-22">Exercise 2.2</h3><p>Rewrite the applyForce method using the static method div() instead of get().</p>











<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>	
  <textarea>void applyForce(PVector force) {
  PVector f = _______.___(_____,____);
  acceleration.add(f);
}</textarea>
  
  
  
  <div class="code-block">
  <div class="code-comment-pair">
    
    <span class="code-comment"></span>
    <code><pre><span class='one-line'><span class="kt">void</span> <span class="nf">applyForce</span><span class="o">(</span><span class="n">PVector</span> <span class="n">force</span><span class="o">)</span> <span class="o">{</span></span>
<span class='one-line'>  <span class="n">PVector</span> <span class="n">f</span> <span class="o">=</span> <span class="n">_______</span><span class="o">.</span><span class="na">___</span><span class="o">(</span><span class="n">_____</span><span class="o">,</span><span class="n">____</span><span class="o">);</span></span>
<span class='one-line'>  <span class="n">acceleration</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">f</span><span class="o">);</span></span>
<span class='one-line'><span class="o">}</span></span></pre></code>
  </div>

</div>
</div>

</div><h2 id="25-creating-forces">2.5 Creating Forces</h2>
<p>Let’s take a moment to remind ourselves where we are.  We know what a force is (a vector), and we know how to apply a force to an object (divide it by mass, add it to the object’s acceleration vector).   What are we missing?  Well, we have yet to figure out how we get a force in the first place.  Where do forces come from?</p>
<p>In this chapter, we’ll look at two methods for creating forces in our Processing world.</p>
<div class="list">
	
	<ol class="arabic">
		
			<li><p><strong>Make up a force!</strong>  After all, you are the programmer, the creator of your world. There’s no reason why you can’t just make up a force and apply it.
</p>
</li>
		
			<li><p><strong>Model a force!</strong>  Yes, forces exist in the real world.  And physics textbooks often contain formulas for these forces.  We can take these formulas, translate them into source code, and model real-world forces in Processing.
</p>
</li>
		
	</ol>
</div><p>The easiest way to make up a force is just to just pick a number.  Let’s start with the idea of simulating wind.  How about a wind force that points to the right and is fairly weak?  Assuming a Mover object “m”, our code would look like:</p>











<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>	
  <textarea>  PVector wind = new PVector(0.01,0);
  m.applyForce(wind);</textarea>
  
  
  
  <div class="code-block">
  <div class="code-comment-pair">
    
    <span class="code-comment"></span>
    <code><pre><span class='one-line'>  <span class="n">PVector</span> <span class="n">wind</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PVector</span><span class="o">(</span><span class="mf">0.01</span><span class="o">,</span><span class="mi">0</span><span class="o">);</span></span>
<span class='one-line'>  <span class="n">m</span><span class="o">.</span><span class="na">applyForce</span><span class="o">(</span><span class="n">wind</span><span class="o">);</span></span></pre></code>
  </div>

</div>
</div>
<p>The result isn’t terribly interesting, but it is a good place to start.  We create a <span class="klass">PVector</span> object, initialize it, and pass it into an object (which in turn will apply it to its own acceleration).
￼
If we wanted to have two forces, perhaps wind and gravity (a bit stronger, pointing down), we might say:</p>
<div class="image-container screenshot" >
	
	<canvas id="sketchdec21a" data-processing-sources="processingjs/chapter02/_2_1_forces/_2_1_forces.pde processingjs/chapter02/_2_1_forces/Mover.pde" class="screenshot">
		<p>Your browser does not support the canvas tag.</p>
	</canvas>
	
	
</div>
<p><span class="example">Example 2.1</span></p>











<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>	
  <textarea>  PVector wind = new PVector(0.01,0);
  PVector gravity = new PVector(0,0.1);
  m.applyForce(wind);
  m.applyForce(gravity);</textarea>
  
  
  
  <div class="code-block">
  <div class="code-comment-pair">
    
    <span class="code-comment"></span>
    <code><pre><span class='one-line'>  <span class="n">PVector</span> <span class="n">wind</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PVector</span><span class="o">(</span><span class="mf">0.01</span><span class="o">,</span><span class="mi">0</span><span class="o">);</span></span>
<span class='one-line'>  <span class="n">PVector</span> <span class="n">gravity</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PVector</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span><span class="mf">0.1</span><span class="o">);</span></span>
<span class='one-line'>  <span class="n">m</span><span class="o">.</span><span class="na">applyForce</span><span class="o">(</span><span class="n">wind</span><span class="o">);</span></span>
<span class='one-line'>  <span class="n">m</span><span class="o">.</span><span class="na">applyForce</span><span class="o">(</span><span class="n">gravity</span><span class="o">);</span></span></pre></code>
  </div>

</div>
</div>
<p>Now we have two forces, pointing in different directions with different magnitudes, both applied to object “<span class="var">m</span>.”  We’re beginning to get somewhere.  We’ve now built a world for our objects in Processing, an environment to which they can actually respond.</p>
<p>Let’s look at how we could make this example a bit more exciting with many objects of varying mass.   To do this, we’ll need to do a quick review of object-oriented programming.  Again, we’re not covering all the basics of programming here (for that you can check out any of the intro Processing books listed in the introduction).  However, since the idea of creating a world filled with objects is pretty fundamental to all the examples in this book, it’s worth taking a moment to walk through the steps of going from one object to many.</p>
<p>This is where we are with the Mover class as a whole.  Notice how it is identical to the Mover class created in Chapter 1, with two additions—<span class="var">mass</span> and a new <span class="function">applyForce()</span> function.</p>











<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>	
  <textarea>class Mover {

  PVector location;
  PVector velocity;
  PVector acceleration;
  // The object now has mass!
  float mass;

  Mover() {
    // And for now, we’ll just set the mass equal to 1 for simplicity.
    mass = 1;
    location = new PVector(30,30);
    velocity = new PVector(0,0);
    acceleration = new PVector(0,0);
  }

  // Newton’s second law.
  void applyForce(PVector force) {
    // Receive a force, divide by mass, and add to acceleration.
    PVector f = PVector.div(force,mass);
    acceleration.add(f);
  }

  void update() {
    // Motion 101 from Chapter 1
    velocity.add(acceleration);
    location.add(velocity);
    // plus clearing the acceleration each time!
    acceleration.mult(0);
  }

  void display() {
    stroke(0);
    fill(175);
    // Let’s scale the size of the object according to its mass.
    ellipse(location.x,location.y,mass*16,mass*16);
  }

  // Somewhat arbitrarily, we are deciding that an object
  // bounces when it hits the edges of a window.
  void checkEdges() {
    if (location.x > width) {
      location.x = width;
      velocity.x *= -1;
    } else if (location.x < 0) {
      velocity.x *= -1;
      location.x = 0;
    }

    if (location.y > height) {
      velocity.y *= -1;
      location.y = height;
    }
  }
}</textarea>
  
  
  
  <div class="code-block">
  <div class="code-comment-pair">
    
    <span class="code-comment"></span>
    <code><pre><span class='one-line'><span class="kd">class</span> <span class="nc">Mover</span> <span class="o">{</span></span>

<span class='one-line'>  <span class="n">PVector</span> <span class="n">location</span><span class="o">;</span></span>
<span class='one-line'>  <span class="n">PVector</span> <span class="n">velocity</span><span class="o">;</span></span>
<span class='one-line'>  <span class="n">PVector</span> <span class="n">acceleration</span><span class="o">;</span></span></pre></code>
  </div>
<div class="code-comment-pair">
    <div class="code-comment-line"></div>
    <span class="code-comment">The object now has mass!</span>
    <code><pre><span class='one-line'>  <span class="kt">float</span> <span class="n">mass</span><span class="o">;</span></span>

<span class='one-line'>  <span class="n">Mover</span><span class="o">()</span> <span class="o">{</span></span></pre></code>
  </div>
<div class="code-comment-pair">
    <div class="code-comment-line"></div>
    <span class="code-comment">And for now, we’ll just set the mass equal to 1 for simplicity.</span>
    <code><pre><span class='one-line'>    <span class="n">mass</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span></span>
<span class='one-line'>    <span class="n">location</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PVector</span><span class="o">(</span><span class="mi">30</span><span class="o">,</span><span class="mi">30</span><span class="o">);</span></span>
<span class='one-line'>    <span class="n">velocity</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PVector</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span><span class="mi">0</span><span class="o">);</span></span>
<span class='one-line'>    <span class="n">acceleration</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PVector</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span><span class="mi">0</span><span class="o">);</span></span>
<span class='one-line'>  <span class="o">}</span></span></pre></code>
  </div>
<div class="code-comment-pair">
    <div class="code-comment-line"></div>
    <span class="code-comment">Newton’s second law.</span>
    <code><pre><span class='one-line'>  <span class="kt">void</span> <span class="nf">applyForce</span><span class="o">(</span><span class="n">PVector</span> <span class="n">force</span><span class="o">)</span> <span class="o">{</span></span></pre></code>
  </div>
<div class="code-comment-pair">
    <div class="code-comment-line"></div>
    <span class="code-comment">Receive a force, divide by mass, and add to acceleration.</span>
    <code><pre><span class='one-line'>    <span class="n">PVector</span> <span class="n">f</span> <span class="o">=</span> <span class="n">PVector</span><span class="o">.</span><span class="na">div</span><span class="o">(</span><span class="n">force</span><span class="o">,</span><span class="n">mass</span><span class="o">);</span></span>
<span class='one-line'>    <span class="n">acceleration</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">f</span><span class="o">);</span></span>
<span class='one-line'>  <span class="o">}</span></span>

<span class='one-line'>  <span class="kt">void</span> <span class="nf">update</span><span class="o">()</span> <span class="o">{</span></span></pre></code>
  </div>
<div class="code-comment-pair">
    <div class="code-comment-line"></div>
    <span class="code-comment">Motion 101 from Chapter 1</span>
    <code><pre><span class='one-line'>    <span class="n">velocity</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">acceleration</span><span class="o">);</span></span>
<span class='one-line'>    <span class="n">location</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">velocity</span><span class="o">);</span></span></pre></code>
  </div>
<div class="code-comment-pair">
    <div class="code-comment-line"></div>
    <span class="code-comment">plus clearing the acceleration each time!</span>
    <code><pre><span class='one-line'>    <span class="n">acceleration</span><span class="o">.</span><span class="na">mult</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span></span>
<span class='one-line'>  <span class="o">}</span></span>

<span class='one-line'>  <span class="kt">void</span> <span class="nf">display</span><span class="o">()</span> <span class="o">{</span></span>
<span class='one-line'>    <span class="n">stroke</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span></span>
<span class='one-line'>    <span class="n">fill</span><span class="o">(</span><span class="mi">175</span><span class="o">);</span></span></pre></code>
  </div>
<div class="code-comment-pair">
    <div class="code-comment-line"></div>
    <span class="code-comment">Let’s scale the size of the object according to its mass.</span>
    <code><pre><span class='one-line'>    <span class="n">ellipse</span><span class="o">(</span><span class="n">location</span><span class="o">.</span><span class="na">x</span><span class="o">,</span><span class="n">location</span><span class="o">.</span><span class="na">y</span><span class="o">,</span><span class="n">mass</span><span class="o">*</span><span class="mi">16</span><span class="o">,</span><span class="n">mass</span><span class="o">*</span><span class="mi">16</span><span class="o">);</span></span>
<span class='one-line'>  <span class="o">}</span></span></pre></code>
  </div>
<div class="code-comment-pair">
    <div class="code-comment-line"></div>
    <span class="code-comment">Somewhat arbitrarily, we are deciding that an object
bounces when it hits the edges of a window.</span>
    <code><pre><span class='one-line'>  <span class="kt">void</span> <span class="nf">checkEdges</span><span class="o">()</span> <span class="o">{</span></span>
<span class='one-line'>    <span class="k">if</span> <span class="o">(</span><span class="n">location</span><span class="o">.</span><span class="na">x</span> <span class="o">&gt;</span> <span class="n">width</span><span class="o">)</span> <span class="o">{</span></span>
<span class='one-line'>      <span class="n">location</span><span class="o">.</span><span class="na">x</span> <span class="o">=</span> <span class="n">width</span><span class="o">;</span></span>
<span class='one-line'>      <span class="n">velocity</span><span class="o">.</span><span class="na">x</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span><span class="o">;</span></span>
<span class='one-line'>    <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">location</span><span class="o">.</span><span class="na">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span></span>
<span class='one-line'>      <span class="n">velocity</span><span class="o">.</span><span class="na">x</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span><span class="o">;</span></span>
<span class='one-line'>      <span class="n">location</span><span class="o">.</span><span class="na">x</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span></span>
<span class='one-line'>    <span class="o">}</span></span>

<span class='one-line'>    <span class="k">if</span> <span class="o">(</span><span class="n">location</span><span class="o">.</span><span class="na">y</span> <span class="o">&gt;</span> <span class="n">height</span><span class="o">)</span> <span class="o">{</span></span>
<span class='one-line'>      <span class="n">velocity</span><span class="o">.</span><span class="na">y</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span><span class="o">;</span></span>
<span class='one-line'>      <span class="n">location</span><span class="o">.</span><span class="na">y</span> <span class="o">=</span> <span class="n">height</span><span class="o">;</span></span>
<span class='one-line'>    <span class="o">}</span></span>
<span class='one-line'>  <span class="o">}</span></span>
<span class='one-line'><span class="o">}</span></span></pre></code>
  </div>

</div>
</div>
<p>Now that our class is set, we can choose to create, say, one hundred <span class="klass">Mover</span> objects with an array.</p>











<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>	
  <textarea>Mover[] movers = new Mover[100];</textarea>
  
  
  
  <div class="code-block">
  <div class="code-comment-pair">
    
    <span class="code-comment"></span>
    <code><pre><span class='one-line'><span class="n">Mover</span><span class="o">[]</span> <span class="n">movers</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Mover</span><span class="o">[</span><span class="mi">100</span><span class="o">];</span></span></pre></code>
  </div>

</div>
</div>
<p>And then we can initialize all of those Mover objects in <span class="function">setup()</span> with a loop.</p>











<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>	
  <textarea>void setup() {
  for (int i = 0; i < movers.length; i++) {
    movers[i] = new Mover();
  }
}</textarea>
  
  
  
  <div class="code-block">
  <div class="code-comment-pair">
    
    <span class="code-comment"></span>
    <code><pre><span class='one-line'><span class="kt">void</span> <span class="nf">setup</span><span class="o">()</span> <span class="o">{</span></span>
<span class='one-line'>  <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">movers</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span></span>
<span class='one-line'>    <span class="n">movers</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Mover</span><span class="o">();</span></span>
<span class='one-line'>  <span class="o">}</span></span>
<span class='one-line'><span class="o">}</span></span></pre></code>
  </div>

</div>
</div>
<p>But now we have a small issue.  If we refer back to the <span class="klass">Mover</span> object’s constructor…</p>











<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>	
  <textarea>  Mover() {
    mass = 1;
    location = new PVector(30,30);
    velocity = new PVector(0,0);
    acceleration = new PVector(0,0);
  }</textarea>
  
  
  
  <div class="code-block">
  <div class="code-comment-pair">
    
    <span class="code-comment"></span>
    <code><pre><span class='one-line'>  <span class="n">Mover</span><span class="o">()</span> <span class="o">{</span></span>
<span class='one-line'>    <span class="n">mass</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span></span>
<span class='one-line'>    <span class="n">location</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PVector</span><span class="o">(</span><span class="mi">30</span><span class="o">,</span><span class="mi">30</span><span class="o">);</span></span>
<span class='one-line'>    <span class="n">velocity</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PVector</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span><span class="mi">0</span><span class="o">);</span></span>
<span class='one-line'>    <span class="n">acceleration</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PVector</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span><span class="mi">0</span><span class="o">);</span></span>
<span class='one-line'>  <span class="o">}</span></span></pre></code>
  </div>

</div>
</div>
<p>…we discover that every Mover object is made exactly the same way.  What we want are Mover objects of varying mass that start at varying locations.  Here is where we need to increase the sophistication of our constructor by adding arguments.</p>











<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>	
  <textarea>  Mover(float m, float x , float y) {
    mass = m;
    location = new PVector(x,y);
    velocity = new PVector(0,0);
    acceleration = new PVector(0,0);
  }</textarea>
  
  
  
  <div class="code-block">
  <div class="code-comment-pair">
    
    <span class="code-comment"></span>
    <code><pre><span class='one-line'>  <span class="n">Mover</span><span class="o">(</span><span class="kt">float</span> <span class="n">m</span><span class="o">,</span> <span class="kt">float</span> <span class="n">x</span> <span class="o">,</span> <span class="kt">float</span> <span class="n">y</span><span class="o">)</span> <span class="o">{</span></span>
<span class='one-line'>    <span class="n">mass</span> <span class="o">=</span> <span class="n">m</span><span class="o">;</span></span>
<span class='one-line'>    <span class="n">location</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PVector</span><span class="o">(</span><span class="n">x</span><span class="o">,</span><span class="n">y</span><span class="o">);</span></span>
<span class='one-line'>    <span class="n">velocity</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PVector</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span><span class="mi">0</span><span class="o">);</span></span>
<span class='one-line'>    <span class="n">acceleration</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PVector</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span><span class="mi">0</span><span class="o">);</span></span>
<span class='one-line'>  <span class="o">}</span></span></pre></code>
  </div>

</div>
</div>
<p>Notice how the mass and location are no longer set to hardcoded numbers, but rather initialized via arguments passed through the constructor.   This means we can create a variety of Mover objects: big ones, small ones, ones that start on the left side of the screen, ones that start on the right, etc.</p>











<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>	
  <textarea>// A big Mover on the left side of the window
Mover m1 = new Mover(10,0,height/2);
// A small Mover on the right side of the window
Mover m1 = new Mover(0.1,width,height/2);</textarea>
  
  
  
  <div class="code-block">
  <div class="code-comment-pair">
    <div class="code-comment-line"></div>
    <span class="code-comment">A big Mover on the left side of the window</span>
    <code><pre><span class='one-line'><span class="n">Mover</span> <span class="n">m1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Mover</span><span class="o">(</span><span class="mi">10</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="n">height</span><span class="o">/</span><span class="mi">2</span><span class="o">);</span></span></pre></code>
  </div>
<div class="code-comment-pair">
    <div class="code-comment-line"></div>
    <span class="code-comment">A small Mover on the right side of the window</span>
    <code><pre><span class='one-line'><span class="n">Mover</span> <span class="n">m1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Mover</span><span class="o">(</span><span class="mf">0.1</span><span class="o">,</span><span class="n">width</span><span class="o">,</span><span class="n">height</span><span class="o">/</span><span class="mi">2</span><span class="o">);</span></span></pre></code>
  </div>

</div>
</div>
<p>With an array, however, we want to initialize all of the objects with a loop.</p>











<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>	
  <textarea>void setup() {
  for (int i = 0; i < movers.length; i++) {
    // Initializing many “Mover” objects all with random mass (and all starting at 0,0).
    movers[i] = new Mover(random(0.1,5),0,0);
  }
}</textarea>
  
  
  
  <div class="code-block">
  <div class="code-comment-pair">
    
    <span class="code-comment"></span>
    <code><pre><span class='one-line'><span class="kt">void</span> <span class="nf">setup</span><span class="o">()</span> <span class="o">{</span></span>
<span class='one-line'>  <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">movers</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span></span></pre></code>
  </div>
<div class="code-comment-pair">
    <div class="code-comment-line"></div>
    <span class="code-comment">Initializing many “Mover” objects all with random mass (and all starting at 0,0).</span>
    <code><pre><span class='one-line'>    <span class="n">movers</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Mover</span><span class="o">(</span><span class="n">random</span><span class="o">(</span><span class="mf">0.1</span><span class="o">,</span><span class="mi">5</span><span class="o">),</span><span class="mi">0</span><span class="o">,</span><span class="mi">0</span><span class="o">);</span></span>
<span class='one-line'>  <span class="o">}</span></span>
<span class='one-line'><span class="o">}</span></span></pre></code>
  </div>

</div>
</div>
<p>For each “Mover” created, the mass is set to a random value between 0.1 and 5, the starting x-location is set to 0, and the starting y-location is set to 0.  Certainly, there are all sorts of ways we might choose to initialize the objects; this is just a demonstration of one possibility.</p>
<p>Once the array of objects is declared, created, and initialized, the rest of the code is simple.  We run through every object, hand them each the forces in the environment, and enjoy the show.</p>
<div class="image-container screenshot" >
	
	<canvas id="sketchdec21a" data-processing-sources="processingjs/chapter02/_2_2_forces_many/_2_2_forces_many.pde processingjs/chapter02/_2_2_forces_many/Mover.pde" class="screenshot">
		<p>Your browser does not support the canvas tag.</p>
	</canvas>
	
	
</div>
<p><span class="example">Example 2.2</span></p>











<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>	
  <textarea>void draw() {
  background(255);

  PVector wind = new PVector(0.01,0);
  // Make up two forces.
  PVector gravity = new PVector(0,0.1);

  for (int i = 0; i < movers.length; i++) {
    movers[i].applyForce(wind);
    // Loop through all objects and apply both forces to each object.
    movers[i].applyForce(gravity);
    movers[i].update();
    movers[i].display();
    movers[i].checkEdges();
  }
}</textarea>
  
  
  
  <div class="code-block">
  <div class="code-comment-pair">
    
    <span class="code-comment"></span>
    <code><pre><span class='one-line'><span class="kt">void</span> <span class="nf">draw</span><span class="o">()</span> <span class="o">{</span></span>
<span class='one-line'>  <span class="n">background</span><span class="o">(</span><span class="mi">255</span><span class="o">);</span></span>

<span class='one-line'>  <span class="n">PVector</span> <span class="n">wind</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PVector</span><span class="o">(</span><span class="mf">0.01</span><span class="o">,</span><span class="mi">0</span><span class="o">);</span></span></pre></code>
  </div>
<div class="code-comment-pair">
    <div class="code-comment-line"></div>
    <span class="code-comment">Make up two forces.</span>
    <code><pre><span class='one-line'>  <span class="n">PVector</span> <span class="n">gravity</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PVector</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span><span class="mf">0.1</span><span class="o">);</span></span>

<span class='one-line'>  <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">movers</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span></span>
<span class='one-line'>    <span class="n">movers</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">applyForce</span><span class="o">(</span><span class="n">wind</span><span class="o">);</span></span></pre></code>
  </div>
<div class="code-comment-pair">
    <div class="code-comment-line"></div>
    <span class="code-comment">Loop through all objects and apply both forces to each object.</span>
    <code><pre><span class='one-line'>    <span class="n">movers</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">applyForce</span><span class="o">(</span><span class="n">gravity</span><span class="o">);</span></span>
<span class='one-line'>    <span class="n">movers</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">update</span><span class="o">();</span></span>
<span class='one-line'>    <span class="n">movers</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">display</span><span class="o">();</span></span>
<span class='one-line'>    <span class="n">movers</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">checkEdges</span><span class="o">();</span></span>
<span class='one-line'>  <span class="o">}</span></span>
<span class='one-line'><span class="o">}</span></span></pre></code>
  </div>

</div>
</div>
<p>Note how in the above image, the smaller circles reach the right of the window faster than the larger ones.  This is because of our formula: <strong><em>acceleration = force divided by mass</em></strong>.   The larger the mass, the smaller the acceleration.</p>
<div class="example">
	<h3 id="exercise-23">Exercise 2.3</h3><p>Create an example where instead of objects bouncing off the edge of the wall, an invisible force pushes back on the objects to keep them in the window.  Can you weight the force according to how far the object is from an edge—i.e., the closer it is, the stronger the force?</p>

</div><h2 id="26-gravity-on-earth-and-modeling-a-force">2.6 Gravity on Earth and Modeling a Force</h2>
<p>You may have noticed something woefully inaccurate about this last example.  The smaller the circle, the faster it falls.   There is a logic to this; after all, we just stated (according to Newton’s second law) that the smaller the mass, the higher the acceleration.  But this is not what happens in the real world.  If you were to climb to the top of the Leaning Tower of Pisa and drop two balls of different masses, which one will hit the ground first?  According to legend, Galileo performed this exact test in 1589, discovering that they fell with the same acceleration, hitting the ground at the same exact time.  Why is this?   As we will see later in this chapter, the force of gravity is calculated relative to an object’s mass.  The bigger the object, the stronger the force.  So if the force is scaled according to mass, it is cancelled out when acceleration is divided by mass.   We can implement this in our sketch rather easily, by multiplying our “made up” gravity force by mass.</p>
<div class="image-container screenshot" >
	
	<canvas id="sketchdec21a" data-processing-sources="processingjs/chapter02/_2_3_forces_many_realgravity/_2_3_forces_many_realgravity.pde processingjs/chapter02/_2_3_forces_many_realgravity/Mover.pde" class="screenshot">
		<p>Your browser does not support the canvas tag.</p>
	</canvas>
	
	
</div>
<p><span class="example">Example 2.3</span></p>











<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>	
  <textarea>for (int i = 0; i < movers.length; i++) {

    PVector wind = new PVector(0.001,0);
    // Scaling gravity by mass to be more accurate
    PVector gravity = new PVector(0,0.1*movers[i].mass);
    movers[i].applyForce(wind);
    movers[i].applyForce(gravity);

    movers[i].update();
    movers[i].display();
    movers[i].checkEdges();
  }</textarea>
  
  
  
  <div class="code-block">
  <div class="code-comment-pair">
    
    <span class="code-comment"></span>
    <code><pre><span class='one-line'><span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">movers</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span></span>

<span class='one-line'>    <span class="n">PVector</span> <span class="n">wind</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PVector</span><span class="o">(</span><span class="mf">0.001</span><span class="o">,</span><span class="mi">0</span><span class="o">);</span></span></pre></code>
  </div>
<div class="code-comment-pair">
    <div class="code-comment-line"></div>
    <span class="code-comment">Scaling gravity by mass to be more accurate</span>
    <code><pre><span class='one-line'>    <span class="n">PVector</span> <span class="n">gravity</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PVector</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span><span class="mf">0.1</span><span class="o">*</span><span class="n">movers</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">mass</span><span class="o">);</span></span>
<span class='one-line'>    <span class="n">movers</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">applyForce</span><span class="o">(</span><span class="n">wind</span><span class="o">);</span></span>
<span class='one-line'>    <span class="n">movers</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">applyForce</span><span class="o">(</span><span class="n">gravity</span><span class="o">);</span></span>

<span class='one-line'>    <span class="n">movers</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">update</span><span class="o">();</span></span>
<span class='one-line'>    <span class="n">movers</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">display</span><span class="o">();</span></span>
<span class='one-line'>    <span class="n">movers</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">checkEdges</span><span class="o">();</span></span>
<span class='one-line'>  <span class="o">}</span></span></pre></code>
  </div>

</div>
</div>
<p>While the object’s now fall at the same rate, because the strength of the wind force is independent of mass, the smaller objects still accelerate to the right more quickly.</p>
<p>Making up forces will actually get us quite far.  The world of Processing is a pretend world of pixels and you are its master.  So whatever you deem appropriate to be a force, well by golly, that’s the force it should be.  Nevertheless, there may come a time where you find yourself wondering: “But how does it really all work?”</p>
<p>Open up any high school physics textbook and you will find some diagrams and formulas describing many different forces—gravity, electromagnetism, friction, tension, elasticity, and more.  In this chapter we’re going to look at two forces—friction and gravity.  The point we’re making here is not that friction and gravity are fundamental forces that you always need to have in your Processing sketches.  Rather, we want to evaluate these two forces as case studies for the following process:</p>
<div class="list">
	
	<ul>
		
			<li><p>
Understanding the concept behind a force
</p>
</li>
		
			<li><p>
Deconstructing the force’s formula into two parts:
</p>
<div class="list">
	
	<ul>
		
			<li><p>
How do we compute the force’s direction?
</p>
</li>
		
			<li><p>
How do we compute the force’s magnitude?
</p>
</li>
		
	</ul>
</div></li>
		
			<li><p>
Translating that formula into Processing code that calculates a <span class="klass">PVector</span> to be sent through our Mover’s <span class="function">applyForce()</span> function.
</p>
</li>
		
	</ul>
</div><p>If we can follow the above steps with two forces, then hopefully if you ever find yourself Googling “atomic nuclei weak nuclear force” at 3 a.m., you will have the skills to take what you find and adapt it for Processing.</p>
<h2 id="27-friction">2.7 Friction</h2>
<p>Let’s begin with friction and follow our steps:</p>
<h3 id="what-is-friction">What is friction?</h3><p>Friction is a “dissipative” force.  A dissipative force is one in which the total energy of a system decreases when an object is in motion.   Let’s say you are driving a car. When you press your foot down on the brake pedal, the car’s brakes use friction to slow down the motion of the tires.  Kinetic energy (motion) is converted into thermal energy (heat).   Whenever two surfaces come into contact, they experience friction.   A complete model of friction would include separate cases for static friction (a body at rest against a surface) and kinetic friction (a body in motion against a surface), but for our purposes, we are going to only look at the kinetic case.</p>
<h3 id="what-is-the-formula-for-friction">What is the formula for friction?</h3><div class="note">
	<h4 id="dealing-with-formulae">Dealing with formulae</h4><p>Ok, in a moment we’re going to write out the formula for friction.  This isn’t the first time we’ve seen a formula is this book; we just finished up our discussion of Newton’s second law, F =MA (or force = mass * acceleration).    We didn’t spend a lot of time worrying about this formula, because it’s a nice and simple one.  Nevertheless, it’s a scary world out there.  Just take a look at the equation for a “normal” distribution which we covered (without looking at the formula) in the introduction  (see [REF]).</p>
<div class="image-container " >
	
	<img src="imgs/chapter02/chapter02_6-01.png" alt="formula" />
	
	<p class="caption">formula</p>
</div>
<p><span class="notetoself">[NEED MATH NOTATION]</span></p>
<p>What we’re seeing here is that formulas like to use a lot of symbols (quite often letters from the Greek alphabet).   Let’s take a look at the formula for friction, which we’re about to cover.</p>
<div class="image-container " >
	
	<img src="imgs/chapter02/chapter02_7-01.png" alt="formula" />
	
	<p class="caption">formula</p>
</div>
<p><span class="notetoself">[NEED MATH NOTATION]</span>
￼
If it’s been a while since you’ve looked at a formula from a math or physics textbook, there are three key points that are important to cover before we move on.</p>
<div class="list">
	
	<ul>
		
			<li><p><strong><em>Evaluate the right side, assign to the left side.</em></strong>  This is just like in code!  What we’re doing here is evaluating the right side of the equation and assigning it to the left.  In the case above, we want to calculate the force of friction—the left side tells us what we want to calculate and the right side tells us how to do it.
</p>
</li>
		
			<li><p><strong><em>Are we talking about a vector or a scalar?</em></strong>  It’s important for us to realize that in some cases, we’ll be looking at a vector; in others, a scalar.   For example, in this case the force of friction is a vector.  It has a magnitude and direction.  We can see that by the arrow above the word “friction.”  The right side of the equation also has a vector, as indicated by the symbol ￼, which is this case stands for the velocity unit vector.
</p>
</li>
		
			<li><p><strong><em>When symbols are placed next too each other, we mean for them to be multiplied.</em></strong>  The formula above actually has four elements:  -1, -μ, N, and v <span class="notetoself">[needs to be unit vector v]</span>.  We want to multiply them together and read the formula as:
</p>
</li>
		
	</ul>
</div><div class="image-container " >
	
	<img src="imgs/chapter02/chapter02_9-01.png" alt="formula" />
	
	<p class="caption">formula</p>
</div>
<p><span class="notetoself">[NEED MATH NOTATION]</span></p>

</div><div class="image-container " >
	
	<img src="imgs/chapter02/ch2_03.png" alt="Figure 2.3" />
	
	<p class="caption">Figure 2.3</p>
</div>
<p>It’s now up to us to separate this formula into two components that determine the direction of friction as well as the magnitude.  Based on the diagram above, we can see that <em>friction points in the opposite direction of velocity.</em>   In fact, that’s the part of the formula that says -1 *  v <span class="notetoself">[needs to be unit vector v]</span> or negative one times the velocity unit vector.  In Processing, this would mean taking the velocity vector, normalizing it, and multiplying by -1.</p>











<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>	
  <textarea>PVector friction = velocity.get();
friction.normalize();
// Let’s figure out the direction of the friction force
// (a unit vector in the opposite direction of velocity).
friction.mult(-1);</textarea>
  
  
  
  <div class="code-block">
  <div class="code-comment-pair">
    
    <span class="code-comment"></span>
    <code><pre><span class='one-line'><span class="n">PVector</span> <span class="n">friction</span> <span class="o">=</span> <span class="n">velocity</span><span class="o">.</span><span class="na">get</span><span class="o">();</span></span>
<span class='one-line'><span class="n">friction</span><span class="o">.</span><span class="na">normalize</span><span class="o">();</span></span></pre></code>
  </div>
<div class="code-comment-pair">
    <div class="code-comment-line"></div>
    <span class="code-comment">Let’s figure out the direction of the friction force
(a unit vector in the opposite direction of velocity).</span>
    <code><pre><span class='one-line'><span class="n">friction</span><span class="o">.</span><span class="na">mult</span><span class="o">(-</span><span class="mi">1</span><span class="o">);</span></span></pre></code>
  </div>

</div>
</div>
<p>Notice two additional steps here.  First, it’s important to make a copy of the velocity vector first as we don’t want to reverse the object’s direction by accident.  Second, we normalize the vector.  This is because the magnitude of friction is not associated with how fast it is moving, and we want to start with a friction vector of magnitude 1 so that it can easily be scaled.</p>
<p>According to the formula, the magnitude is <span class="var">μ</span> * <span class="var">N</span>.   <span class="var">μ</span> is the Greek letter Mu (pronounced “mew”), which is used here to describe the “coefficient of friction.”   The coefficient of friction establishes the strength of a friction force for a particular surface.  The higher it is, the stronger the friction; the lower, the weaker.   A block of ice, for example, will have a much lower coefficient of friction than, say, sandpaper.   Since we’re in a pretend Processing world, we can arbitrarily set the coefficient based on how much friction we want to simulate.</p>











<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>	
  <textarea>float c = 0.01;</textarea>
  
  
  
  <div class="code-block">
  <div class="code-comment-pair">
    
    <span class="code-comment"></span>
    <code><pre><span class='one-line'><span class="kt">float</span> <span class="n">c</span> <span class="o">=</span> <span class="mf">0.01</span><span class="o">;</span></span></pre></code>
  </div>

</div>
</div>
<p>Now for the second part: <span class="var">N</span>.  <span class="var">N</span> refers to the “normal” force, the force perpendicular to the object’s motion along a surface.  Think of a vehicle driving along a road.   The vehicle pushes down against the road with gravity, and Newton’s third law tells us that the road in turn pushes back against the vehicle.  That’s the normal force.  The greater the gravitational force, the greater the normal force.   As we’ll see in the next section, gravity is associated with mass and so a lightweight sports car would experience less friction than a massive tractor trailer truck.   With the diagram above, however, where the object is moving along a surface at an angle, computing the normal force is a bit more complicated because it doesn’t point in the same direction as gravity.  We’ll need to know something about angles and trigonometry.</p>
<p>All of these specifics are important; however, in Processing, a “good enough” simulation can be achieved without them.  We can, for example, make friction work with the assumption that the normal force will always have a magnitude of 1.  When we get into trigonometry in the next chapter, we’ll remember to return to this question and make our friction example a bit more sophisticated.  Therefore:</p>











<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>	
  <textarea>float normal = 1;</textarea>
  
  
  
  <div class="code-block">
  <div class="code-comment-pair">
    
    <span class="code-comment"></span>
    <code><pre><span class='one-line'><span class="kt">float</span> <span class="n">normal</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span></span></pre></code>
  </div>

</div>
</div>
<p>Now that we have both the magnitude and direction for friction, we can put it all together:</p>











<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>	
  <textarea>float c = 0.01;
float normal = 1;
// Let’s figure out the magnitude of friction
// (really just an arbitrary constant).
float frictionMag = c*normal;

PVector friction = velocity.get();
friction.mult(-1);
friction.normalize();

// Take the unit vector and multiply it by magnitude
// and we have our force vector!
friction.mult(frictionMag);</textarea>
  
  
  
  <div class="code-block">
  <div class="code-comment-pair">
    
    <span class="code-comment"></span>
    <code><pre><span class='one-line'><span class="kt">float</span> <span class="n">c</span> <span class="o">=</span> <span class="mf">0.01</span><span class="o">;</span></span>
<span class='one-line'><span class="kt">float</span> <span class="n">normal</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span></span></pre></code>
  </div>
<div class="code-comment-pair">
    <div class="code-comment-line"></div>
    <span class="code-comment">Let’s figure out the magnitude of friction
(really just an arbitrary constant).</span>
    <code><pre><span class='one-line'><span class="kt">float</span> <span class="n">frictionMag</span> <span class="o">=</span> <span class="n">c</span><span class="o">*</span><span class="n">normal</span><span class="o">;</span></span>

<span class='one-line'><span class="n">PVector</span> <span class="n">friction</span> <span class="o">=</span> <span class="n">velocity</span><span class="o">.</span><span class="na">get</span><span class="o">();</span></span>
<span class='one-line'><span class="n">friction</span><span class="o">.</span><span class="na">mult</span><span class="o">(-</span><span class="mi">1</span><span class="o">);</span></span>
<span class='one-line'><span class="n">friction</span><span class="o">.</span><span class="na">normalize</span><span class="o">();</span></span></pre></code>
  </div>
<div class="code-comment-pair">
    <div class="code-comment-line"></div>
    <span class="code-comment">Take the unit vector and multiply it by magnitude
and we have our force vector!</span>
    <code><pre><span class='one-line'><span class="n">friction</span><span class="o">.</span><span class="na">mult</span><span class="o">(</span><span class="n">frictionMag</span><span class="o">);</span></span></pre></code>
  </div>

</div>
</div>
<p>…and add it to our “forces” example, where many objects experience wind, gravity, and now friction:</p>
<div class="image-container two-col" >
	
	<canvas id="sketchdec21a" data-processing-sources="processingjs/chapter02/_2_4_forces_nofriction/_2_4_forces_nofriction.pde processingjs/chapter02/_2_4_forces_nofriction/Mover.pde" class="two-col">
		<p>Your browser does not support the canvas tag.</p>
	</canvas>
	
	<p class="caption">No friction</p>
</div>
<div class="image-container two-col" >
	
	<canvas id="sketchdec21a" data-processing-sources="processingjs/chapter02/_2_4_forces_friction/_2_4_forces_friction.pde processingjs/chapter02/_2_4_forces_friction/Mover.pde" class="two-col">
		<p>Your browser does not support the canvas tag.</p>
	</canvas>
	
	<p class="caption">With friction</p>
</div>
<p><span class="example">Example 2.4: Including friction</span></p>











<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>	
  <textarea>void draw() {
  background(255);

  PVector wind = new PVector(0.001,0);
  // We could scale by mass to be more accurate
  PVector gravity = new PVector(0,0.1);

  for (int i = 0; i < movers.length; i++) {

    float c = 0.01; // [bold]
    PVector friction = movers[i].velocity.get(); // [bold]
    friction.mult(-1); // [bold]
    friction.normalize(); // [bold]
    friction.mult(c); // [bold]

    // Apply friction force vector to object
    movers[i].applyForce(friction); // [bold]
    movers[i].applyForce(wind);
    movers[i].applyForce(gravity);

    movers[i].update();
    movers[i].display();
    movers[i].checkEdges();
  }

}</textarea>
  
  
  
  <div class="code-block">
  <div class="code-comment-pair">
    
    <span class="code-comment"></span>
    <code><pre><span class='one-line'><span class="kt">void</span> <span class="nf">draw</span><span class="o">()</span> <span class="o">{</span></span>
<span class='one-line'>  <span class="n">background</span><span class="o">(</span><span class="mi">255</span><span class="o">);</span></span>

<span class='one-line'>  <span class="n">PVector</span> <span class="n">wind</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PVector</span><span class="o">(</span><span class="mf">0.001</span><span class="o">,</span><span class="mi">0</span><span class="o">);</span></span></pre></code>
  </div>
<div class="code-comment-pair">
    <div class="code-comment-line"></div>
    <span class="code-comment">We could scale by mass to be more accurate</span>
    <code><pre><span class='one-line'>  <span class="n">PVector</span> <span class="n">gravity</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PVector</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span><span class="mf">0.1</span><span class="o">);</span></span>

<span class='one-line'>  <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">movers</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span></span>

<span class='one-line'>    <span class="kt">float</span> <span class="n">c</span> <span class="o">=</span> <span class="mf">0.01</span><span class="o">;</span> <span class="c1">// [bold]</span></span>
<span class='one-line'>    <span class="n">PVector</span> <span class="n">friction</span> <span class="o">=</span> <span class="n">movers</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">velocity</span><span class="o">.</span><span class="na">get</span><span class="o">();</span> <span class="c1">// [bold]</span></span>
<span class='one-line'>    <span class="n">friction</span><span class="o">.</span><span class="na">mult</span><span class="o">(-</span><span class="mi">1</span><span class="o">);</span> <span class="c1">// [bold]</span></span>
<span class='one-line'>    <span class="n">friction</span><span class="o">.</span><span class="na">normalize</span><span class="o">();</span> <span class="c1">// [bold]</span></span>
<span class='one-line'>    <span class="n">friction</span><span class="o">.</span><span class="na">mult</span><span class="o">(</span><span class="n">c</span><span class="o">);</span> <span class="c1">// [bold]</span></span></pre></code>
  </div>
<div class="code-comment-pair">
    <div class="code-comment-line"></div>
    <span class="code-comment">Apply friction force vector to object</span>
    <code><pre><span class='one-line'>    <span class="n">movers</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">applyForce</span><span class="o">(</span><span class="n">friction</span><span class="o">);</span> <span class="c1">// [bold]</span></span>
<span class='one-line'>    <span class="n">movers</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">applyForce</span><span class="o">(</span><span class="n">wind</span><span class="o">);</span></span>
<span class='one-line'>    <span class="n">movers</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">applyForce</span><span class="o">(</span><span class="n">gravity</span><span class="o">);</span></span>

<span class='one-line'>    <span class="n">movers</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">update</span><span class="o">();</span></span>
<span class='one-line'>    <span class="n">movers</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">display</span><span class="o">();</span></span>
<span class='one-line'>    <span class="n">movers</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">checkEdges</span><span class="o">();</span></span>
<span class='one-line'>  <span class="o">}</span></span>

<span class='one-line'><span class="o">}</span></span></pre></code>
  </div>

</div>
</div>
<p>Running this example, you’ll notice that the circles don’t even make it to the right side of the window.  Since friction continuously pushes against the object in the opposite direction of its movement, the object continuously slows down.  This can be a useful technique or a problem depending on the goals of your visualization.</p>
<div class="example">
	<h4 id="exercise-24">Exercise 2.4</h4><p>Create pockets of friction in a Processing sketch so that objects only experience the friction when crossing over that area.    What if you vary the strength (friction coefficient) of each area?   What if you make some of them the opposite of friction—i.e., when you enter a given pocket you actually speed up instead of slowing down?</p>

</div><h2 id="28-air-and-fluid-resistance">2.8 Air and Fluid Resistance</h2>
<p>Friction also occurs when a body passes through a liquid or gas.  This force has many different names, all really meaning the same thing: viscous force, drag force, fluid resistance.  While the result is ultimately the same as our previous friction examples (the object slows down), the way in which we calculate a drag force will be slightly different.  Let’s look at the formula:</p>
<div class="image-container " >
	
	<img src="imgs/chapter02/ch2_04.png" alt="Figure 2.4" />
	
	<p class="caption">Figure 2.4</p>
</div>
<div class="image-container " >
	
	<img src="imgs/chapter02/chapter02_15-01.png" alt="formula" />
	
	<p class="caption">formula</p>
</div>
<p><span class="notetoself">[Need Math Notation]</span></p>
<p>Now let’s break this down and see what we really need for an effective simulation in Processing, making ourselves a much simpler formula in the process.</p>
<div class="list">
	
	<ul>
		
			<li><p><span class="var">F<sub>d</sub></span> refers to “Drag Force”, the vector we ultimately want to compute and pass into our <span class="function">applyForce()</span> function.
</p>
</li>
		
			<li><p>
- 1/2 is a constant: -0.5!   This is fairly irrelevant in terms of our Processing world, as we will be making up values for other constants anyway.   However, the fact that it is negative is important, as it tells us that the force is in the opposite direction of velocity (just as with friction).
-￼ρ is the Greek letter rho, and refers to the density of the liquid, something we don’t need to worry about.  We can simplify the problem and consider this to have a constant value of 1.
</p>
</li>
		
			<li><p><span class="var">v</span> refers to the speed of the object moving.  OK, we’ve got this one!  The object’s speed is the magnitude of the velocity vector:  velocity.magnitude().  And <span class="var">v</span><sup>2</sup> just means <span class="var">v</span> squared or <span class="var">v</span> * <span class="var">v</span>.
</p>
</li>
		
			<li><p>
A refers to the frontal area of the object that is pushing through the liquid (or gas).  An aerodynamic Lamborghini, for example, will experience less air resistance than a boxy Volvo.   Nevertheless, for a basic simulation, we can consider our object to be spherical and ignore this element.
</p>
</li>
		
			<li><p><span class="var">C<sub>d</sub></span> is the coefficient of drag, exactly the same as the coefficient of friction (<span class="var">μ</span>).  This is a constant we’ll determine based on whether we want the drag force to be strong or weak.
</p>
</li>
		
			<li><p>
v <span class="notetoself">[need math notation, velocity unit vector]</span> Look familiar?  It should.  This refers to the velocity unit vector, i.e. velocity.normalize().  Just like with ￼friction, drag is a force that points in the opposite direction of velocity.
</p>
</li>
		
	</ul>
</div><p>Now that we’ve analyzed each of these components and determined what we need for a simple simulation, we can reduce our formula to:</p>
<p><strong>[var]*F<sub>d</sub></strong> = -1 * <span class="var">C<sub>d</sub></span> * <span class="var">v</span><sup>2</sup> * v
<span class="notetoself">need math notation, velocity unit vector</span></p>
<p>or:</p>











<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>	
  <textarea>float c = 0.1;
float speed = v.mag();
// Part 1 of our formula (magnitude): Cd * v2
float dragMagnitude = c * speed * speed;
PVector drag = velocity.get();
// Part 2 of our formula (direction):
// -1 * velocity￼
drag.mult(-1);
drag.normalize();
// Magnitude and direction together!
drag.mult(dragMagnitude);</textarea>
  
  
  
  <div class="code-block">
  <div class="code-comment-pair">
    
    <span class="code-comment"></span>
    <code><pre><span class='one-line'><span class="kt">float</span> <span class="n">c</span> <span class="o">=</span> <span class="mf">0.1</span><span class="o">;</span></span>
<span class='one-line'><span class="kt">float</span> <span class="n">speed</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="na">mag</span><span class="o">();</span></span></pre></code>
  </div>
<div class="code-comment-pair">
    <div class="code-comment-line"></div>
    <span class="code-comment">Part 1 of our formula (magnitude): Cd * v2</span>
    <code><pre><span class='one-line'><span class="kt">float</span> <span class="n">dragMagnitude</span> <span class="o">=</span> <span class="n">c</span> <span class="o">*</span> <span class="n">speed</span> <span class="o">*</span> <span class="n">speed</span><span class="o">;</span></span>
<span class='one-line'><span class="n">PVector</span> <span class="n">drag</span> <span class="o">=</span> <span class="n">velocity</span><span class="o">.</span><span class="na">get</span><span class="o">();</span></span></pre></code>
  </div>
<div class="code-comment-pair">
    <div class="code-comment-line"></div>
    <span class="code-comment">Part 2 of our formula (direction):
-1 * velocity￼</span>
    <code><pre><span class='one-line'><span class="n">drag</span><span class="o">.</span><span class="na">mult</span><span class="o">(-</span><span class="mi">1</span><span class="o">);</span></span>
<span class='one-line'><span class="n">drag</span><span class="o">.</span><span class="na">normalize</span><span class="o">();</span></span></pre></code>
  </div>
<div class="code-comment-pair">
    <div class="code-comment-line"></div>
    <span class="code-comment">Magnitude and direction together!</span>
    <code><pre><span class='one-line'><span class="n">drag</span><span class="o">.</span><span class="na">mult</span><span class="o">(</span><span class="n">dragMagnitude</span><span class="o">);</span></span></pre></code>
  </div>

</div>
</div>
<p>Let’s implement this force in our Mover example with one addition.   When we wrote our friction example, the force of friction was always present.  Whenever an object was moving, friction would slow it down.  Here, let’s introduce an element to the environment—a “liquid” that the Mover objects pass through.  The liquid object will be a rectangle and will know about its location, width, height, and “coefficient of drag”—i.e., is it easy for objects to move through it (like air) or difficult (like molasses)?  In addition, it should include a function to draw itself on the screen (and two more functions, which we’ll see in a moment.)</p>











<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>	
  <textarea>class Liquid {
  // The liquid object includes a variable defining
  // its coefficient of drag.
  float x,y,w,h;
  float c;

  Liquid(float x_, float y_, float w_, float h_, float c_) {
    x = x_;
    y = y_;
    w = w_;
    h = h_;
    c = c_;
  }

  void display() {
    noStroke();
    fill(175);
    rect(x,y,w,h);
  }

}</textarea>
  
  
  
  <div class="code-block">
  <div class="code-comment-pair">
    
    <span class="code-comment"></span>
    <code><pre><span class='one-line'><span class="kd">class</span> <span class="nc">Liquid</span> <span class="o">{</span></span></pre></code>
  </div>
<div class="code-comment-pair">
    <div class="code-comment-line"></div>
    <span class="code-comment">The liquid object includes a variable defining
its coefficient of drag.</span>
    <code><pre><span class='one-line'>  <span class="kt">float</span> <span class="n">x</span><span class="o">,</span><span class="n">y</span><span class="o">,</span><span class="n">w</span><span class="o">,</span><span class="n">h</span><span class="o">;</span></span>
<span class='one-line'>  <span class="kt">float</span> <span class="n">c</span><span class="o">;</span></span>

<span class='one-line'>  <span class="n">Liquid</span><span class="o">(</span><span class="kt">float</span> <span class="n">x_</span><span class="o">,</span> <span class="kt">float</span> <span class="n">y_</span><span class="o">,</span> <span class="kt">float</span> <span class="n">w_</span><span class="o">,</span> <span class="kt">float</span> <span class="n">h_</span><span class="o">,</span> <span class="kt">float</span> <span class="n">c_</span><span class="o">)</span> <span class="o">{</span></span>
<span class='one-line'>    <span class="n">x</span> <span class="o">=</span> <span class="n">x_</span><span class="o">;</span></span>
<span class='one-line'>    <span class="n">y</span> <span class="o">=</span> <span class="n">y_</span><span class="o">;</span></span>
<span class='one-line'>    <span class="n">w</span> <span class="o">=</span> <span class="n">w_</span><span class="o">;</span></span>
<span class='one-line'>    <span class="n">h</span> <span class="o">=</span> <span class="n">h_</span><span class="o">;</span></span>
<span class='one-line'>    <span class="n">c</span> <span class="o">=</span> <span class="n">c_</span><span class="o">;</span></span>
<span class='one-line'>  <span class="o">}</span></span>

<span class='one-line'>  <span class="kt">void</span> <span class="nf">display</span><span class="o">()</span> <span class="o">{</span></span>
<span class='one-line'>    <span class="n">noStroke</span><span class="o">();</span></span>
<span class='one-line'>    <span class="n">fill</span><span class="o">(</span><span class="mi">175</span><span class="o">);</span></span>
<span class='one-line'>    <span class="n">rect</span><span class="o">(</span><span class="n">x</span><span class="o">,</span><span class="n">y</span><span class="o">,</span><span class="n">w</span><span class="o">,</span><span class="n">h</span><span class="o">);</span></span>
<span class='one-line'>  <span class="o">}</span></span>

<span class='one-line'><span class="o">}</span></span></pre></code>
  </div>

</div>
</div>
<p>The main program will now include a Liquid object reference as well as a line of code that initializes that object.</p>











<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>	
  <textarea>Liquid liquid;

void setup() {
  // Initialize a Liquid object.  Note how the coefficient value is low (0.1).
  // Otherwise, the object would come to a halt fairly quickly (which may someday be the effect you want).
  liquid = new Liquid(0, height/2, width, height/2, 0.1);
}</textarea>
  
  
  
  <div class="code-block">
  <div class="code-comment-pair">
    
    <span class="code-comment"></span>
    <code><pre><span class='one-line'><span class="n">Liquid</span> <span class="n">liquid</span><span class="o">;</span></span>

<span class='one-line'><span class="kt">void</span> <span class="nf">setup</span><span class="o">()</span> <span class="o">{</span></span></pre></code>
  </div>
<div class="code-comment-pair">
    <div class="code-comment-line"></div>
    <span class="code-comment">Initialize a Liquid object.  Note how the coefficient value is low (0.1).
Otherwise, the object would come to a halt fairly quickly (which may someday be the effect you want).</span>
    <code><pre><span class='one-line'>  <span class="n">liquid</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Liquid</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="n">height</span><span class="o">/</span><span class="mi">2</span><span class="o">,</span> <span class="n">width</span><span class="o">,</span> <span class="n">height</span><span class="o">/</span><span class="mi">2</span><span class="o">,</span> <span class="mf">0.1</span><span class="o">);</span></span>
<span class='one-line'><span class="o">}</span></span></pre></code>
  </div>

</div>
</div>
<p>Now comes an interesting question: how do we get the Mover object to talk to the Liquid object?  In other words, we want to execute the following:</p>
<p><em>When a Mover passes through a Liquid it experiences a Drag force.</em></p>
<p>or in object-oriented speak (assuming we are looping through an array of Mover objects with index i):</p>











<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>	
  <textarea>if (movers[i].isInside(liquid)) {
  // If a Mover is inside a Liquid, apply the drag force.
  movers[i].drag(liquid);
}</textarea>
  
  
  
  <div class="code-block">
  <div class="code-comment-pair">
    
    <span class="code-comment"></span>
    <code><pre><span class='one-line'><span class="k">if</span> <span class="o">(</span><span class="n">movers</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">isInside</span><span class="o">(</span><span class="n">liquid</span><span class="o">))</span> <span class="o">{</span></span></pre></code>
  </div>
<div class="code-comment-pair">
    <div class="code-comment-line"></div>
    <span class="code-comment">If a Mover is inside a Liquid, apply the drag force.</span>
    <code><pre><span class='one-line'>  <span class="n">movers</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">drag</span><span class="o">(</span><span class="n">liquid</span><span class="o">);</span></span>
<span class='one-line'><span class="o">}</span></span></pre></code>
  </div>

</div>
</div>
<p>The above code tells us that we need to add two functions to the Mover class: (1) a function that determines if a Mover object is inside the liquid, and (2) a function that computes and applies a drag force on the Mover object.</p>
<p>The first is easy; we can simply use a conditional statement to determine if the location vector rests inside the rectangle defined by the liquid.</p>











<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>	
  <textarea>boolean isInside(Liquid l) {
  if (location.x > l.x && location.x < l.x + l.w && location.y > l.y && location.y < l.y + l.h) {
    // This conditional statement determines
    // if the PVector location is inside the rectangle
    // defined by the Liquid class.
    return true;
  } else {
    return false;
  }
}</textarea>
  
  
  
  <div class="code-block">
  <div class="code-comment-pair">
    
    <span class="code-comment"></span>
    <code><pre><span class='one-line'><span class="kt">boolean</span> <span class="nf">isInside</span><span class="o">(</span><span class="n">Liquid</span> <span class="n">l</span><span class="o">)</span> <span class="o">{</span></span>
<span class='one-line'>  <span class="k">if</span> <span class="o">(</span><span class="n">location</span><span class="o">.</span><span class="na">x</span> <span class="o">&gt;</span> <span class="n">l</span><span class="o">.</span><span class="na">x</span> <span class="o">&amp;&amp;</span> <span class="n">location</span><span class="o">.</span><span class="na">x</span> <span class="o">&lt;</span> <span class="n">l</span><span class="o">.</span><span class="na">x</span> <span class="o">+</span> <span class="n">l</span><span class="o">.</span><span class="na">w</span> <span class="o">&amp;&amp;</span> <span class="n">location</span><span class="o">.</span><span class="na">y</span> <span class="o">&gt;</span> <span class="n">l</span><span class="o">.</span><span class="na">y</span> <span class="o">&amp;&amp;</span> <span class="n">location</span><span class="o">.</span><span class="na">y</span> <span class="o">&lt;</span> <span class="n">l</span><span class="o">.</span><span class="na">y</span> <span class="o">+</span> <span class="n">l</span><span class="o">.</span><span class="na">h</span><span class="o">)</span> <span class="o">{</span></span></pre></code>
  </div>
<div class="code-comment-pair">
    <div class="code-comment-line"></div>
    <span class="code-comment">This conditional statement determines
if the PVector location is inside the rectangle
defined by the Liquid class.</span>
    <code><pre><span class='one-line'>    <span class="k">return</span> <span class="kc">true</span><span class="o">;</span></span>
<span class='one-line'>  <span class="o">}</span> <span class="k">else</span> <span class="o">{</span></span>
<span class='one-line'>    <span class="k">return</span> <span class="kc">false</span><span class="o">;</span></span>
<span class='one-line'>  <span class="o">}</span></span>
<span class='one-line'><span class="o">}</span></span></pre></code>
  </div>

</div>
</div>
<p>The <span class="function">drag()</span> function is a bit more complicated; however, we’ve written the code for it already.  This is simply an implementation of our formula.  The drag force is equal to <em>the coefficient of drag multiplied by the speed of the Mover squared in the opposite direction of velocity!</em></p>
<p><strong>[var]*F<sub>d</sub></strong> = -1 * <span class="var">C<sub>d</sub></span> * <span class="var">v</span><sup>2</sup> * v <span class="notetoself">[need math notation, velocity unit vector]</span></p>











<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>	
  <textarea> void drag(Liquid l) {

    float speed = velocity.mag();
    // The force’s magnitude: Cd * v2
    float dragMagnitude = l.c * speed * speed;

    PVector drag = velocity.get();
    drag.mult(-1);
    // The force's direction: -1 * velocity
    drag.normalize();

    // Finalize force: magnitude and direction -Cd * speed * speed * velocity unit vector
    drag.mult(dragMagnitude);

    // Apply the force
    applyForce(drag);
  }</textarea>
  
  
  
  <div class="code-block">
  <div class="code-comment-pair">
    
    <span class="code-comment"></span>
    <code><pre><span class='one-line'> <span class="kt">void</span> <span class="nf">drag</span><span class="o">(</span><span class="n">Liquid</span> <span class="n">l</span><span class="o">)</span> <span class="o">{</span></span>

<span class='one-line'>    <span class="kt">float</span> <span class="n">speed</span> <span class="o">=</span> <span class="n">velocity</span><span class="o">.</span><span class="na">mag</span><span class="o">();</span></span></pre></code>
  </div>
<div class="code-comment-pair">
    <div class="code-comment-line"></div>
    <span class="code-comment">The force’s magnitude: Cd * v2</span>
    <code><pre><span class='one-line'>    <span class="kt">float</span> <span class="n">dragMagnitude</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="na">c</span> <span class="o">*</span> <span class="n">speed</span> <span class="o">*</span> <span class="n">speed</span><span class="o">;</span></span>

<span class='one-line'>    <span class="n">PVector</span> <span class="n">drag</span> <span class="o">=</span> <span class="n">velocity</span><span class="o">.</span><span class="na">get</span><span class="o">();</span></span>
<span class='one-line'>    <span class="n">drag</span><span class="o">.</span><span class="na">mult</span><span class="o">(-</span><span class="mi">1</span><span class="o">);</span></span></pre></code>
  </div>
<div class="code-comment-pair">
    <div class="code-comment-line"></div>
    <span class="code-comment">The force's direction: -1 * velocity</span>
    <code><pre><span class='one-line'>    <span class="n">drag</span><span class="o">.</span><span class="na">normalize</span><span class="o">();</span></span></pre></code>
  </div>
<div class="code-comment-pair">
    <div class="code-comment-line"></div>
    <span class="code-comment">Finalize force: magnitude and direction -Cd * speed * speed * velocity unit vector</span>
    <code><pre><span class='one-line'>    <span class="n">drag</span><span class="o">.</span><span class="na">mult</span><span class="o">(</span><span class="n">dragMagnitude</span><span class="o">);</span></span></pre></code>
  </div>
<div class="code-comment-pair">
    <div class="code-comment-line"></div>
    <span class="code-comment">Apply the force</span>
    <code><pre><span class='one-line'>    <span class="n">applyForce</span><span class="o">(</span><span class="n">drag</span><span class="o">);</span></span>
<span class='one-line'>  <span class="o">}</span></span></pre></code>
  </div>

</div>
</div>
<p>And with these two functions added to the Mover class, we’re ready to put it all together in the main tab:</p>
<div class="image-container screenshot" >
	
	<canvas id="sketchdec21a" data-processing-sources="processingjs/chapter02/_2_5_fluidresistance/_2_5_fluidresistance.pde processingjs/chapter02/_2_5_fluidresistance/Liquid.pde processingjs/chapter02/_2_5_fluidresistance/Mover.pde" class="screenshot">
		<p>Your browser does not support the canvas tag.</p>
	</canvas>
	
	
</div>
<p><span class="example">Example 2.5: Fluid Resistance</span></p>











<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>	
  <textarea>Mover[] movers = new Mover[100];

Liquid liquid;

void setup() {
  size(360, 640);
  smooth();
  for (int i = 0; i < movers.length; i++) {
    movers[i] = new Mover(random(0.1,5),0,0);
  }
  liquid = new Liquid(0, height/2, width, height/2, 0.1);
}

void draw() {
  background(255);

  liquid.display();

  for (int i = 0; i < movers.length; i++) {

    if (movers[i].isInside(liquid)) {
      movers[i].drag(liquid);
    }

    // Note we are scaling gravity according to mass.
    PVector gravity = new PVector(0, 0.1*movers[i].mass);
    movers[i].applyForce(gravity);

    movers[i].update();
    movers[i].display();
    movers[i].checkEdges();
  }
}</textarea>
  
  
  
  <div class="code-block">
  <div class="code-comment-pair">
    
    <span class="code-comment"></span>
    <code><pre><span class='one-line'><span class="n">Mover</span><span class="o">[]</span> <span class="n">movers</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Mover</span><span class="o">[</span><span class="mi">100</span><span class="o">];</span></span>

<span class='one-line'><span class="n">Liquid</span> <span class="n">liquid</span><span class="o">;</span></span>

<span class='one-line'><span class="kt">void</span> <span class="nf">setup</span><span class="o">()</span> <span class="o">{</span></span>
<span class='one-line'>  <span class="n">size</span><span class="o">(</span><span class="mi">360</span><span class="o">,</span> <span class="mi">640</span><span class="o">);</span></span>
<span class='one-line'>  <span class="n">smooth</span><span class="o">();</span></span>
<span class='one-line'>  <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">movers</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span></span>
<span class='one-line'>    <span class="n">movers</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Mover</span><span class="o">(</span><span class="n">random</span><span class="o">(</span><span class="mf">0.1</span><span class="o">,</span><span class="mi">5</span><span class="o">),</span><span class="mi">0</span><span class="o">,</span><span class="mi">0</span><span class="o">);</span></span>
<span class='one-line'>  <span class="o">}</span></span>
<span class='one-line'>  <span class="n">liquid</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Liquid</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="n">height</span><span class="o">/</span><span class="mi">2</span><span class="o">,</span> <span class="n">width</span><span class="o">,</span> <span class="n">height</span><span class="o">/</span><span class="mi">2</span><span class="o">,</span> <span class="mf">0.1</span><span class="o">);</span></span>
<span class='one-line'><span class="o">}</span></span>

<span class='one-line'><span class="kt">void</span> <span class="nf">draw</span><span class="o">()</span> <span class="o">{</span></span>
<span class='one-line'>  <span class="n">background</span><span class="o">(</span><span class="mi">255</span><span class="o">);</span></span>

<span class='one-line'>  <span class="n">liquid</span><span class="o">.</span><span class="na">display</span><span class="o">();</span></span>

<span class='one-line'>  <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">movers</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span></span>

<span class='one-line'>    <span class="k">if</span> <span class="o">(</span><span class="n">movers</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">isInside</span><span class="o">(</span><span class="n">liquid</span><span class="o">))</span> <span class="o">{</span></span>
<span class='one-line'>      <span class="n">movers</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">drag</span><span class="o">(</span><span class="n">liquid</span><span class="o">);</span></span>
<span class='one-line'>    <span class="o">}</span></span></pre></code>
  </div>
<div class="code-comment-pair">
    <div class="code-comment-line"></div>
    <span class="code-comment">Note we are scaling gravity according to mass.</span>
    <code><pre><span class='one-line'>    <span class="n">PVector</span> <span class="n">gravity</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PVector</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mf">0.1</span><span class="o">*</span><span class="n">movers</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">mass</span><span class="o">);</span></span>
<span class='one-line'>    <span class="n">movers</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">applyForce</span><span class="o">(</span><span class="n">gravity</span><span class="o">);</span></span>

<span class='one-line'>    <span class="n">movers</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">update</span><span class="o">();</span></span>
<span class='one-line'>    <span class="n">movers</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">display</span><span class="o">();</span></span>
<span class='one-line'>    <span class="n">movers</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">checkEdges</span><span class="o">();</span></span>
<span class='one-line'>  <span class="o">}</span></span>
<span class='one-line'><span class="o">}</span></span></pre></code>
  </div>

</div>
</div>
<p>Running the example, you should notice that we are simulating balls falling into water.  The objects only slow down when crossing in the gray area at the bottom of the window (representing the liquid).  You’ll also notice that the smaller objects slow down a great deal more than the larger objects.    Remember Newton’s second law?  <span class="var">A</span> = <span class="var">F</span> / <span class="var">M</span>. Acceleration equals Force <strong><em>divided</em></strong> by mass.  A massive object will accelerate less.  A smaller object will accelerate more.    In this case, the acceleration we’re talking about is the “slowing down” due to drag.  The smaller objects will slow down at a greater rate than the larger ones.</p>
<div class="example">
	<h3 id="exercise-26">Exercise 2.6</h3><p>Take a look at our formula for drag again.  <strong><em>DRAG FORCE = COEFFICIENT * SPEED * SPEED</em></strong>.  The faster an object moves, the greater the drag force against it.  In fact, an object not moving in water experiences no drag at all.   Expand the example to drop the balls from different heights.  How does this affect the drag as they hit the water?</p>

</div><div class="example">
	<h3 id="exercise-27">Exercise 2.7</h3><p>The formula for drag also included surface area.  Can you create a simulation of boxes falling into water with a drag force dependent on the length of the side hitting the water?</p>

</div><div class="example">
	<h3 id="exercise-28">Exercise 2.8</h3><p>Fluid resistance does not work only opposite to the velocity vector, but also perpendicular to it.  This is known as “lift-induced drag” and will cause an airplane with an angled wing to rise in altitude.   Try creating a simulation of lift.</p>

</div><h2 id="29-gravitational-attraction">2.9 Gravitational Attraction</h2>
<p>Probably the most famous force of all is gravity.   We humans on earth think of gravity as an apple hitting Isaac Newton on the head.    Gravity means that stuff falls down.  But this is only our experience of gravity.   In truth, just as the earth pulls the apple towards it due to a gravitational force, the apple pulls the earth as well.   The thing is, the earth is just so freaking big that it overwhelms all the other gravity interactions.  Every object with mass exerts a gravitational force on every other object.   And there is a formula for calculating the strengths of these forces:</p>
<div class="image-container half-width-right" >
	
	<img src="imgs/chapter02/ch2_05.png" alt="Figure 2.5" />
	
	<p class="caption">Figure 2.5</p>
</div>
<p>Let’s examine this formula a bit more closely:</p>
<div class="list">
	
	<ul>
		
			<li><p><span class="var">F</span> refers to the gravitational force, the vector we ultimately want to compute and pass into our applyForce() function.
</p>
</li>
		
			<li><p><span class="var">G</span> is the “Universal Gravitational Constant” and in our world equals 6.67428 x 10-11 meters cubed per kilogram per second squared.   This is a pretty important number if your name is Isaac Newton or Albert Einstein.  It’s not an important number if you are a Processing programmer.  Again, it’s a constant that we can use to make the forces in our world weaker or stronger.  Just making it equal to one and ignoring it isn’t such a terrible choice either.
</p>
</li>
		
			<li><p><span class="var">m<sub>1</sub></span> and <span class="var">m<sub>2</sub></span> are the masses of objects 1 and 2.   As we saw with Newton’s second law (F = M*A), mass is also something we could choose to ignore.  After all, shapes drawn on the screen don’t actually have a physical mass.  However, if we keep these values, we can create more interesting simulations where “bigger” objects exert a stronger gravitational force than smaller ones.
</p>
</li>
		
			<li><p>
r <span class="notetoself">[math notation]</span> refers to the unit vector pointing from object 1 to object 2.  As we’ll see in a moment, we can compute this direction vector by subtracting the location of one object from the other.
</p>
</li>
		
			<li><p><span class="var">r</span><sup>2</sup> refers to the distance between the two objects squared.  Let’s take a moment to think about this a bit more.  With everything on the top of the formula—<span class="var">G</span>, <span class="var">m<sub>1</sub></span>, <span class="var">m<sub>2</sub>*—the bigger its value, the stronger the force.  Big mass, big force.  Big [var]*G</span>, big force.  Now, when we divide by something we have the opposite.  The strength of the force is inversely proportional to the distance squared.  The <em>further</em> away an object is, the <em>weaker</em> the force; the <em>closer</em>, the <em>stronger</em>.
</p>
</li>
		
	</ul>
</div><p>Hopefully by now the formula makes some sense to us.  We’ve looked at a diagram and dissected the individual components of the formula.  Now it’s time to figure out how we translate the math into Processing code.  Let’s make the following assumptions.</p>
<p>We have two objects and:</p>
<div class="list">
	
	<ol class="arabic">
		
			<li><p>
Each object has a location: <span class="var">PVector location1</span> and <span class="var">PVector location2</span>.
</p>
</li>
		
			<li><p>
Each object has a mass: <span class="var">float mass1</span> and <span class="var">float mass2</span>.
</p>
</li>
		
			<li><p>
There is a variable <span class="var">float G</span> for the universal gravitational constant.
</p>
</li>
		
	</ol>
</div><p>Given these assumptions, we want to compute <span class="var">PVector force</span>, the force of gravity.  We’ll do it in two parts.  First, we’ll compute the direction of the force r <span class="notetoself">[math notation]</span> in the formula above).  Second, we’ll calculate the strength of the force according to the masses and distance.</p>
<div class="image-container half-width-right" >
	
	<img src="imgs/chapter02/ch2_06.png" alt="Figure 2.6" />
	
	<p class="caption">Figure 2.6</p>
</div>
<p>Remember in Chapter 1, when we figured out how to have an object accelerate towards the mouse?</p>
<p>A vector is the difference between two points. To make a vector that points from the circle to the mouse, we simply subtract one point from another:</p>











<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>	
  <textarea>PVector dir = PVector.sub(mouse,location);</textarea>
  
  
  
  <div class="code-block">
  <div class="code-comment-pair">
    
    <span class="code-comment"></span>
    <code><pre><span class='one-line'><span class="n">PVector</span> <span class="n">dir</span> <span class="o">=</span> <span class="n">PVector</span><span class="o">.</span><span class="na">sub</span><span class="o">(</span><span class="n">mouse</span><span class="o">,</span><span class="n">location</span><span class="o">);</span></span></pre></code>
  </div>

</div>
</div>
<p>In our case, the direction of the attraction force that object 1 exerts on object 2 is equal to:</p>











<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>	
  <textarea>PVector dir = PVector.sub(location1,location2);
dir.normalize();</textarea>
  
  
  
  <div class="code-block">
  <div class="code-comment-pair">
    
    <span class="code-comment"></span>
    <code><pre><span class='one-line'><span class="n">PVector</span> <span class="n">dir</span> <span class="o">=</span> <span class="n">PVector</span><span class="o">.</span><span class="na">sub</span><span class="o">(</span><span class="n">location1</span><span class="o">,</span><span class="n">location2</span><span class="o">);</span></span>
<span class='one-line'><span class="n">dir</span><span class="o">.</span><span class="na">normalize</span><span class="o">();</span></span></pre></code>
  </div>

</div>
</div>
<p>Don’t forget that since we want a unit vector, a vector that tells us about direction only, we’ll need to <strong><em>normalize</em></strong> the vector after subtracting the locations.</p>
<p>OK, we’ve got the direction of the force.  Now we just need to compute the magnitude and scale the vector accordingly.</p>











<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>	
  <textarea>float m = (G * mass1 * mass2) / (distance * distance);
dir.mult(m);</textarea>
  
  
  
  <div class="code-block">
  <div class="code-comment-pair">
    
    <span class="code-comment"></span>
    <code><pre><span class='one-line'><span class="kt">float</span> <span class="n">m</span> <span class="o">=</span> <span class="o">(</span><span class="n">G</span> <span class="o">*</span> <span class="n">mass1</span> <span class="o">*</span> <span class="n">mass2</span><span class="o">)</span> <span class="o">/</span> <span class="o">(</span><span class="n">distance</span> <span class="o">*</span> <span class="n">distance</span><span class="o">);</span></span>
<span class='one-line'><span class="n">dir</span><span class="o">.</span><span class="na">mult</span><span class="o">(</span><span class="n">m</span><span class="o">);</span></span></pre></code>
  </div>

</div>
</div>
<div class="image-container half-width-right" >
	
	<img src="imgs/chapter02/ch2_07.png" alt="Figure 2.7" />
	
	<p class="caption">Figure 2.7</p>
</div>
<p>The only problem is that we don’t know the distance.  <span class="var">G</span>, <span class="var">mass1</span>, and <span class="var">mass2</span> were all givens, but we’ll need to actually compute distance before the above code will work.   Didn’t we just make a vector that points all the way from one location to another?   Wouldn’t the length of that vector be the distance between two objects?</p>
<p>Well, if we add just one line of code and grab the magnitude of that vector before normalizing it, then we’ll have the distance.</p>











<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>	
  <textarea>// The vector that points from one object to another
PVector force = PVector.sub(location1,location2);

// The length (magnitude) of that vector
// is the distance between the two objects.
float distance = force.magnitude();

float m = (G * mass1 * mass2) / (distance * distance);
// Use the formula for gravity to compute
// the strength of the force.

// Normalize and scale the force vector
// to the appropriate magnitude.
force.normalize();
force.mult(m);</textarea>
  
  
  
  <div class="code-block">
  <div class="code-comment-pair">
    <div class="code-comment-line"></div>
    <span class="code-comment">The vector that points from one object to another</span>
    <code><pre><span class='one-line'><span class="n">PVector</span> <span class="n">force</span> <span class="o">=</span> <span class="n">PVector</span><span class="o">.</span><span class="na">sub</span><span class="o">(</span><span class="n">location1</span><span class="o">,</span><span class="n">location2</span><span class="o">);</span></span></pre></code>
  </div>
<div class="code-comment-pair">
    <div class="code-comment-line"></div>
    <span class="code-comment">The length (magnitude) of that vector
is the distance between the two objects.</span>
    <code><pre><span class='one-line'><span class="kt">float</span> <span class="n">distance</span> <span class="o">=</span> <span class="n">force</span><span class="o">.</span><span class="na">magnitude</span><span class="o">();</span></span>

<span class='one-line'><span class="kt">float</span> <span class="n">m</span> <span class="o">=</span> <span class="o">(</span><span class="n">G</span> <span class="o">*</span> <span class="n">mass1</span> <span class="o">*</span> <span class="n">mass2</span><span class="o">)</span> <span class="o">/</span> <span class="o">(</span><span class="n">distance</span> <span class="o">*</span> <span class="n">distance</span><span class="o">);</span></span></pre></code>
  </div>
<div class="code-comment-pair">
    <div class="code-comment-line"></div>
    <span class="code-comment">Use the formula for gravity to compute
the strength of the force.</span>
    <code><pre></pre></code>
  </div>
<div class="code-comment-pair">
    <div class="code-comment-line"></div>
    <span class="code-comment">Normalize and scale the force vector
to the appropriate magnitude.</span>
    <code><pre><span class='one-line'><span class="n">force</span><span class="o">.</span><span class="na">normalize</span><span class="o">();</span></span>
<span class='one-line'><span class="n">force</span><span class="o">.</span><span class="na">mult</span><span class="o">(</span><span class="n">m</span><span class="o">);</span></span></pre></code>
  </div>

</div>
</div>
<p>Note that I also renamed the PVector “dir” as “force.”   After all, when we’re finished with the calculations, the PVector we started with ends up being the actual force vector we wanted all along.</p>
<p>Now that we’ve worked out the math and the code for calculating an attractive force (emulating gravity), we need to turn our attention to applying this technique in the context of an actual Processing sketch.   In Example 2.x, you may recall how we created a simple Mover object—a class with PVector’s location, velocity, and acceleration as well as an <span class="function">applyForce()</span>.  Let’s take this exact class and put it in a sketch with:</p>
<div class="image-container half-width" >
	
	<img src="imgs/chapter02/ch2_08.png" alt="imgs/chapter02/ch2_08.png" />
	
	
</div>
<div class="list">
	
	<ul>
		
			<li><p>
A single Mover object.
</p>
</li>
		
			<li><p>
A single Attractor object (a new class that will have a fixed location).
</p>
</li>
		
	</ul>
</div><p>The Mover object will experience a gravitational pull towards the Attractor object, as illustrated in Figure X.X.</p>
<p>We can start by making the new Attractor class very simple—a location and a mass, along with a function to display itself (tying mass to size).</p>











<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>	
  <textarea>class Attractor {
  // Our Attractor is a simple object that doesn’t move.
  // We just need a mass and a location.
  float mass;
  PVector location;

  Attractor() {
    location = new PVector(width/2,height/2);
    mass = 20;
  }

  void display() {
    stroke(0);
    fill(175,200);
    ellipse(location.x,location.y,mass*2,mass*2);
  }
}</textarea>
  
  
  
  <div class="code-block">
  <div class="code-comment-pair">
    
    <span class="code-comment"></span>
    <code><pre><span class='one-line'><span class="kd">class</span> <span class="nc">Attractor</span> <span class="o">{</span></span></pre></code>
  </div>
<div class="code-comment-pair">
    <div class="code-comment-line"></div>
    <span class="code-comment">Our Attractor is a simple object that doesn’t move.
We just need a mass and a location.</span>
    <code><pre><span class='one-line'>  <span class="kt">float</span> <span class="n">mass</span><span class="o">;</span></span>
<span class='one-line'>  <span class="n">PVector</span> <span class="n">location</span><span class="o">;</span></span>

<span class='one-line'>  <span class="n">Attractor</span><span class="o">()</span> <span class="o">{</span></span>
<span class='one-line'>    <span class="n">location</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PVector</span><span class="o">(</span><span class="n">width</span><span class="o">/</span><span class="mi">2</span><span class="o">,</span><span class="n">height</span><span class="o">/</span><span class="mi">2</span><span class="o">);</span></span>
<span class='one-line'>    <span class="n">mass</span> <span class="o">=</span> <span class="mi">20</span><span class="o">;</span></span>
<span class='one-line'>  <span class="o">}</span></span>

<span class='one-line'>  <span class="kt">void</span> <span class="nf">display</span><span class="o">()</span> <span class="o">{</span></span>
<span class='one-line'>    <span class="n">stroke</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span></span>
<span class='one-line'>    <span class="n">fill</span><span class="o">(</span><span class="mi">175</span><span class="o">,</span><span class="mi">200</span><span class="o">);</span></span>
<span class='one-line'>    <span class="n">ellipse</span><span class="o">(</span><span class="n">location</span><span class="o">.</span><span class="na">x</span><span class="o">,</span><span class="n">location</span><span class="o">.</span><span class="na">y</span><span class="o">,</span><span class="n">mass</span><span class="o">*</span><span class="mi">2</span><span class="o">,</span><span class="n">mass</span><span class="o">*</span><span class="mi">2</span><span class="o">);</span></span>
<span class='one-line'>  <span class="o">}</span></span>
<span class='one-line'><span class="o">}</span></span></pre></code>
  </div>

</div>
</div>
<p>And in our main program, we can add an instance of the Attractor class.</p>











<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>	
  <textarea>Mover m;
Attractor a;

void setup() {
  size(200,200);
  m = new Mover();
  // Initialize Attractor object.
  a = new Attractor();
}

void draw() {
  background(255);

  // Display Attractor object.
  a.display();

  m.update();
  m.display();
}</textarea>
  
  
  
  <div class="code-block">
  <div class="code-comment-pair">
    
    <span class="code-comment"></span>
    <code><pre><span class='one-line'><span class="n">Mover</span> <span class="n">m</span><span class="o">;</span></span>
<span class='one-line'><span class="n">Attractor</span> <span class="n">a</span><span class="o">;</span></span>

<span class='one-line'><span class="kt">void</span> <span class="nf">setup</span><span class="o">()</span> <span class="o">{</span></span>
<span class='one-line'>  <span class="n">size</span><span class="o">(</span><span class="mi">200</span><span class="o">,</span><span class="mi">200</span><span class="o">);</span></span>
<span class='one-line'>  <span class="n">m</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Mover</span><span class="o">();</span></span></pre></code>
  </div>
<div class="code-comment-pair">
    <div class="code-comment-line"></div>
    <span class="code-comment">Initialize Attractor object.</span>
    <code><pre><span class='one-line'>  <span class="n">a</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Attractor</span><span class="o">();</span></span>
<span class='one-line'><span class="o">}</span></span>

<span class='one-line'><span class="kt">void</span> <span class="nf">draw</span><span class="o">()</span> <span class="o">{</span></span>
<span class='one-line'>  <span class="n">background</span><span class="o">(</span><span class="mi">255</span><span class="o">);</span></span></pre></code>
  </div>
<div class="code-comment-pair">
    <div class="code-comment-line"></div>
    <span class="code-comment">Display Attractor object.</span>
    <code><pre><span class='one-line'>  <span class="n">a</span><span class="o">.</span><span class="na">display</span><span class="o">();</span></span>

<span class='one-line'>  <span class="n">m</span><span class="o">.</span><span class="na">update</span><span class="o">();</span></span>
<span class='one-line'>  <span class="n">m</span><span class="o">.</span><span class="na">display</span><span class="o">();</span></span>
<span class='one-line'><span class="o">}</span></span></pre></code>
  </div>

</div>
</div>
<p>This is a good structure: a main program with a Mover and Attractor object, and a class to handle the variables and behaviors of Movers and Attractors.   The last piece of the puzzle is how to get one object to attract the other.  How do we get these two objects to talk to each other?</p>
<p>There are a number of ways we could do this.  Here are just a few possibilities:</p>
<div class="table">
	
		<h4>Table</h4>
	
	<table>
		
	
		
	
		<tbody>
		
			<tr>
				
					<td><p>1. A function that receives both an <span class="klass">Attractor</span> and a <span class="klass">Mover</span>:</p>
</td>
				
					<td><p>attraction(a,m);</p>
</td>
				
			</tr>
		
			<tr>
				
					<td><p>2. A function in the <span class="klass">Attractor</span> class that receives a <span class="klass">Mover</span>:</p>
</td>
				
					<td><p>a.attract(m);</p>
</td>
				
			</tr>
		
			<tr>
				
					<td><p>3. A function in the <span class="klass">Mover</span> class that receives an <span class="klass">Attractor</span>:</p>
</td>
				
					<td><p>m.attractedTo(a);</p>
</td>
				
			</tr>
		
			<tr>
				
					<td><p>4. A function in the <span class="klass">Attractor</span> class that receives a <span class="klass">Mover</span> and returns a <span class="klass">PVector</span>, which is the attraction force.  That attraction force is then passed into the <span class="klass">Mover*’s [function]*applyForce()</span> function:</p>
</td>
				
					<td><p>PVector f = a.attract(m);
m.applyForce(f);</p>
</td>
				
			</tr>
		
		</tbody>
	</table>
</div><p>and so on. . .</p>
<p>It’s good to look at a range of options for making objects talk to each other, and you could probably make arguments for each of the above possibilities.  I’d like to at least discard the first one, since an object-oriented approach is really a much better choice over an arbitrary function not tied to either the Mover or Attractor class.   Whether you pick (2) or (3) is the difference between saying “The attractor attracts the mover” or “The mover is attracted to the attractor.”  Number 4 is really my favorite, at least in terms of where we are in this book.  After all, we spent a lot of time working out the <span class="function">applyForce()</span> function and I think our examples will be clearer if we continue with the same methodology.</p>
<p>In other words, where we once had:</p>











<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>	
  <textarea>// Made-up force
PVector f = new PVector(0.1,0);
m.applyForce(f);</textarea>
  
  
  
  <div class="code-block">
  <div class="code-comment-pair">
    <div class="code-comment-line"></div>
    <span class="code-comment">Made-up force</span>
    <code><pre><span class='one-line'><span class="n">PVector</span> <span class="n">f</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PVector</span><span class="o">(</span><span class="mf">0.1</span><span class="o">,</span><span class="mi">0</span><span class="o">);</span></span>
<span class='one-line'><span class="n">m</span><span class="o">.</span><span class="na">applyForce</span><span class="o">(</span><span class="n">f</span><span class="o">);</span></span></pre></code>
  </div>

</div>
</div>
<p>We now have:</p>











<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>	
  <textarea>// Attraction force between two objects
PVector f = a.attract(m);
m.applyForce(f);</textarea>
  
  
  
  <div class="code-block">
  <div class="code-comment-pair">
    <div class="code-comment-line"></div>
    <span class="code-comment">Attraction force between two objects</span>
    <code><pre><span class='one-line'><span class="n">PVector</span> <span class="n">f</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="na">attract</span><span class="o">(</span><span class="n">m</span><span class="o">);</span></span>
<span class='one-line'><span class="n">m</span><span class="o">.</span><span class="na">applyForce</span><span class="o">(</span><span class="n">f</span><span class="o">);</span></span></pre></code>
  </div>

</div>
</div>
<p>And so our draw() function can now be written as:</p>











<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>	
  <textarea>void draw() {
  background(255);

  // Calculate attraction force and apply it.
  *PVector f = a.attract(m);
  m.applyForce(f);*

  m.update();

  a.display();
  m.display();

}</textarea>
  
  
  
  <div class="code-block">
  <div class="code-comment-pair">
    
    <span class="code-comment"></span>
    <code><pre><span class='one-line'><span class="kt">void</span> <span class="nf">draw</span><span class="o">()</span> <span class="o">{</span></span>
<span class='one-line'>  <span class="n">background</span><span class="o">(</span><span class="mi">255</span><span class="o">);</span></span></pre></code>
  </div>
<div class="code-comment-pair">
    <div class="code-comment-line"></div>
    <span class="code-comment">Calculate attraction force and apply it.</span>
    <code><pre><span class='one-line'>  <span class="o">*</span><span class="n">PVector</span> <span class="n">f</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="na">attract</span><span class="o">(</span><span class="n">m</span><span class="o">);</span></span>
<span class='one-line'>  <span class="n">m</span><span class="o">.</span><span class="na">applyForce</span><span class="o">(</span><span class="n">f</span><span class="o">);*</span></span>

<span class='one-line'>  <span class="n">m</span><span class="o">.</span><span class="na">update</span><span class="o">();</span></span>

<span class='one-line'>  <span class="n">a</span><span class="o">.</span><span class="na">display</span><span class="o">();</span></span>
<span class='one-line'>  <span class="n">m</span><span class="o">.</span><span class="na">display</span><span class="o">();</span></span>

<span class='one-line'><span class="o">}</span></span></pre></code>
  </div>

</div>
</div>
<p>We’re almost there.  Since we decided to put the attract() function inside of the Attractor class, we’ll need to actually write that function.   The function needs to receive a Mover object and return a PVector, i.e.:</p>











<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>	
  <textarea>PVector attract(Mover m) {

}</textarea>
  
  
  
  <div class="code-block">
  <div class="code-comment-pair">
    
    <span class="code-comment"></span>
    <code><pre><span class='one-line'><span class="n">PVector</span> <span class="nf">attract</span><span class="o">(</span><span class="n">Mover</span> <span class="n">m</span><span class="o">)</span> <span class="o">{</span></span>

<span class='one-line'><span class="o">}</span></span></pre></code>
  </div>

</div>
</div>
<p>And what goes inside that function?  All of that nice math we worked out for gravitational attraction!</p>











<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>	
  <textarea>PVector attract(Mover m) {

  // What’s the force’s direction?
  PVector force = PVector.sub(location,m.location);
  float distance = force.mag();
  force.normalize();
  // What’s the force’s magnitude?
  float strength = (G * mass * m.mass) / (distance * distance);
  force.mult(strength);

  // Return the force so that it can be applied!
  return force;
}</textarea>
  
  
  
  <div class="code-block">
  <div class="code-comment-pair">
    
    <span class="code-comment"></span>
    <code><pre><span class='one-line'><span class="n">PVector</span> <span class="nf">attract</span><span class="o">(</span><span class="n">Mover</span> <span class="n">m</span><span class="o">)</span> <span class="o">{</span></span></pre></code>
  </div>
<div class="code-comment-pair">
    <div class="code-comment-line"></div>
    <span class="code-comment">What’s the force’s direction?</span>
    <code><pre><span class='one-line'>  <span class="n">PVector</span> <span class="n">force</span> <span class="o">=</span> <span class="n">PVector</span><span class="o">.</span><span class="na">sub</span><span class="o">(</span><span class="n">location</span><span class="o">,</span><span class="n">m</span><span class="o">.</span><span class="na">location</span><span class="o">);</span></span>
<span class='one-line'>  <span class="kt">float</span> <span class="n">distance</span> <span class="o">=</span> <span class="n">force</span><span class="o">.</span><span class="na">mag</span><span class="o">();</span></span>
<span class='one-line'>  <span class="n">force</span><span class="o">.</span><span class="na">normalize</span><span class="o">();</span></span></pre></code>
  </div>
<div class="code-comment-pair">
    <div class="code-comment-line"></div>
    <span class="code-comment">What’s the force’s magnitude?</span>
    <code><pre><span class='one-line'>  <span class="kt">float</span> <span class="n">strength</span> <span class="o">=</span> <span class="o">(</span><span class="n">G</span> <span class="o">*</span> <span class="n">mass</span> <span class="o">*</span> <span class="n">m</span><span class="o">.</span><span class="na">mass</span><span class="o">)</span> <span class="o">/</span> <span class="o">(</span><span class="n">distance</span> <span class="o">*</span> <span class="n">distance</span><span class="o">);</span></span>
<span class='one-line'>  <span class="n">force</span><span class="o">.</span><span class="na">mult</span><span class="o">(</span><span class="n">strength</span><span class="o">);</span></span></pre></code>
  </div>
<div class="code-comment-pair">
    <div class="code-comment-line"></div>
    <span class="code-comment">Return the force so that it can be applied!</span>
    <code><pre><span class='one-line'>  <span class="k">return</span> <span class="n">force</span><span class="o">;</span></span>
<span class='one-line'><span class="o">}</span></span></pre></code>
  </div>

</div>
</div>
<p>And we’re done.  Sort of.  Almost.  There’s one small kink we need to work out.  Let’s look at the above code again.  See that symbol for divide, the slash?  Whenever we have one of these, we need to ask ourselves the question:  What would happen if  the distance happened to be a really, really small number or (even worse!) zero??!  Well, we know we can’t divide a number by zero, and if we were to divide a number by something like 0.0001, that is the equivalent of multiplying that number by 10,000!   Yes, this is the real-world formula for the strength of gravity, but we don’t live in the real world.  We live in the <em>Processing</em> world.   And in the Processing world, the Mover could end up being very, very close to the Attractor and the force could become so strong the Mover would just fly way off the screen.   And so with this formula, it’s good for us to be practical and constrain the range of what distance can actually be.   Maybe, no matter where the Mover actually is, we should never consider it less than 5 pixels or more than 25 pixels away from the Attractor.</p>











<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>	
  <textarea>  distance = constrain(distance,5,25);</textarea>
  
  
  
  <div class="code-block">
  <div class="code-comment-pair">
    
    <span class="code-comment"></span>
    <code><pre><span class='one-line'>  <span class="n">distance</span> <span class="o">=</span> <span class="n">constrain</span><span class="o">(</span><span class="n">distance</span><span class="o">,</span><span class="mi">5</span><span class="o">,</span><span class="mi">25</span><span class="o">);</span></span></pre></code>
  </div>

</div>
</div>
<p>For the same reason we need to constrain the minimum distance, it’s useful for us to do the same with the maximum.  After all, if the Mover were to be, say, 500 pixels from the Attractor (not unreasonable), we’d be dividing the force by 250,000.  That force might end up being so weak that it’s almost as if we’re not applying it at all.</p>
<p>Now, it’s really up to you to decide what behaviors you want.  But in the case of, “I want reasonable-looking attraction that is never absurdly weak or strong,” then constraining the distance is a good technique.</p>
<p>Our Mover class hasn’t changed at all, so let’s just look at the main program and Attractor class as a whole, adding a variable “g” for the universal gravitational constant.  (On the web site, you’ll find that this example also has code that allows you to move the Attractor object with the mouse):</p>
<div class="image-container screenshot" >
	
	<canvas id="sketchdec21a" data-processing-sources="processingjs/chapter02/_2_6_attraction/_2_6_attraction.pde processingjs/chapter02/_2_6_attraction/Attractor.pde processingjs/chapter02/_2_6_attraction/Mover.pde" class="screenshot">
		<p>Your browser does not support the canvas tag.</p>
	</canvas>
	
	
</div>
<p><span class="example">Example 2.6: Attraction</span></p>











<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>	
  <textarea>// A Mover and an Attractor
Mover m;
Attractor a;

void setup() {
  size(200,200);
  m = new Mover();
  a = new Attractor();
}

void draw() {
  background(255);

  // Apply the attraction force from the Attractor on the Mover.
  PVector force = a.attract(m);
  m.applyForce(force);
  m.update();

  a.display();
  m.display();
}

class Attractor {
  float mass;
  PVector location;
  float G;

  Attractor() {
    location = new PVector(width/2,height/2);
    mass = 20;
    G = 0.4;
  }

  PVector attract(Mover m) {
    PVector force = PVector.sub(location,m.location);
    float distance = force.mag();
    // Remember, weneed to constrain the distance
    // so that our circle doesn’t spin out of control.
    distance = constrain(distance,5.0,25.0);
    force.normalize();
    float strength = (G * mass * m.mass) / (distance * distance);
    force.mult(strength);
    return force;
  }

  void display() {
    stroke(0);
    fill(175,200);
    ellipse(location.x,location.y,mass*2,mass*2);
  }
}</textarea>
  
  
  
  <div class="code-block">
  <div class="code-comment-pair">
    <div class="code-comment-line"></div>
    <span class="code-comment">A Mover and an Attractor</span>
    <code><pre><span class='one-line'><span class="n">Mover</span> <span class="n">m</span><span class="o">;</span></span>
<span class='one-line'><span class="n">Attractor</span> <span class="n">a</span><span class="o">;</span></span>

<span class='one-line'><span class="kt">void</span> <span class="nf">setup</span><span class="o">()</span> <span class="o">{</span></span>
<span class='one-line'>  <span class="n">size</span><span class="o">(</span><span class="mi">200</span><span class="o">,</span><span class="mi">200</span><span class="o">);</span></span>
<span class='one-line'>  <span class="n">m</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Mover</span><span class="o">();</span></span>
<span class='one-line'>  <span class="n">a</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Attractor</span><span class="o">();</span></span>
<span class='one-line'><span class="o">}</span></span>

<span class='one-line'><span class="kt">void</span> <span class="nf">draw</span><span class="o">()</span> <span class="o">{</span></span>
<span class='one-line'>  <span class="n">background</span><span class="o">(</span><span class="mi">255</span><span class="o">);</span></span></pre></code>
  </div>
<div class="code-comment-pair">
    <div class="code-comment-line"></div>
    <span class="code-comment">Apply the attraction force from the Attractor on the Mover.</span>
    <code><pre><span class='one-line'>  <span class="n">PVector</span> <span class="n">force</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="na">attract</span><span class="o">(</span><span class="n">m</span><span class="o">);</span></span>
<span class='one-line'>  <span class="n">m</span><span class="o">.</span><span class="na">applyForce</span><span class="o">(</span><span class="n">force</span><span class="o">);</span></span>
<span class='one-line'>  <span class="n">m</span><span class="o">.</span><span class="na">update</span><span class="o">();</span></span>

<span class='one-line'>  <span class="n">a</span><span class="o">.</span><span class="na">display</span><span class="o">();</span></span>
<span class='one-line'>  <span class="n">m</span><span class="o">.</span><span class="na">display</span><span class="o">();</span></span>
<span class='one-line'><span class="o">}</span></span>

<span class='one-line'><span class="kd">class</span> <span class="nc">Attractor</span> <span class="o">{</span></span>
<span class='one-line'>  <span class="kt">float</span> <span class="n">mass</span><span class="o">;</span></span>
<span class='one-line'>  <span class="n">PVector</span> <span class="n">location</span><span class="o">;</span></span>
<span class='one-line'>  <span class="kt">float</span> <span class="n">G</span><span class="o">;</span></span>

<span class='one-line'>  <span class="n">Attractor</span><span class="o">()</span> <span class="o">{</span></span>
<span class='one-line'>    <span class="n">location</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PVector</span><span class="o">(</span><span class="n">width</span><span class="o">/</span><span class="mi">2</span><span class="o">,</span><span class="n">height</span><span class="o">/</span><span class="mi">2</span><span class="o">);</span></span>
<span class='one-line'>    <span class="n">mass</span> <span class="o">=</span> <span class="mi">20</span><span class="o">;</span></span>
<span class='one-line'>    <span class="n">G</span> <span class="o">=</span> <span class="mf">0.4</span><span class="o">;</span></span>
<span class='one-line'>  <span class="o">}</span></span>

<span class='one-line'>  <span class="n">PVector</span> <span class="nf">attract</span><span class="o">(</span><span class="n">Mover</span> <span class="n">m</span><span class="o">)</span> <span class="o">{</span></span>
<span class='one-line'>    <span class="n">PVector</span> <span class="n">force</span> <span class="o">=</span> <span class="n">PVector</span><span class="o">.</span><span class="na">sub</span><span class="o">(</span><span class="n">location</span><span class="o">,</span><span class="n">m</span><span class="o">.</span><span class="na">location</span><span class="o">);</span></span>
<span class='one-line'>    <span class="kt">float</span> <span class="n">distance</span> <span class="o">=</span> <span class="n">force</span><span class="o">.</span><span class="na">mag</span><span class="o">();</span></span></pre></code>
  </div>
<div class="code-comment-pair">
    <div class="code-comment-line"></div>
    <span class="code-comment">Remember, weneed to constrain the distance
so that our circle doesn’t spin out of control.</span>
    <code><pre><span class='one-line'>    <span class="n">distance</span> <span class="o">=</span> <span class="n">constrain</span><span class="o">(</span><span class="n">distance</span><span class="o">,</span><span class="mf">5.0</span><span class="o">,</span><span class="mf">25.0</span><span class="o">);</span></span>
<span class='one-line'>    <span class="n">force</span><span class="o">.</span><span class="na">normalize</span><span class="o">();</span></span>
<span class='one-line'>    <span class="kt">float</span> <span class="n">strength</span> <span class="o">=</span> <span class="o">(</span><span class="n">G</span> <span class="o">*</span> <span class="n">mass</span> <span class="o">*</span> <span class="n">m</span><span class="o">.</span><span class="na">mass</span><span class="o">)</span> <span class="o">/</span> <span class="o">(</span><span class="n">distance</span> <span class="o">*</span> <span class="n">distance</span><span class="o">);</span></span>
<span class='one-line'>    <span class="n">force</span><span class="o">.</span><span class="na">mult</span><span class="o">(</span><span class="n">strength</span><span class="o">);</span></span>
<span class='one-line'>    <span class="k">return</span> <span class="n">force</span><span class="o">;</span></span>
<span class='one-line'>  <span class="o">}</span></span>

<span class='one-line'>  <span class="kt">void</span> <span class="nf">display</span><span class="o">()</span> <span class="o">{</span></span>
<span class='one-line'>    <span class="n">stroke</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span></span>
<span class='one-line'>    <span class="n">fill</span><span class="o">(</span><span class="mi">175</span><span class="o">,</span><span class="mi">200</span><span class="o">);</span></span>
<span class='one-line'>    <span class="n">ellipse</span><span class="o">(</span><span class="n">location</span><span class="o">.</span><span class="na">x</span><span class="o">,</span><span class="n">location</span><span class="o">.</span><span class="na">y</span><span class="o">,</span><span class="n">mass</span><span class="o">*</span><span class="mi">2</span><span class="o">,</span><span class="n">mass</span><span class="o">*</span><span class="mi">2</span><span class="o">);</span></span>
<span class='one-line'>  <span class="o">}</span></span>
<span class='one-line'><span class="o">}</span></span></pre></code>
  </div>

</div>
</div>
<p>And we could, of course, expand this example using an array to include many Mover objects, just as we did with friction and drag:</p>
<div class="image-container screenshot" >
	
	<canvas id="sketchdec21a" data-processing-sources="processingjs/chapter02/_2_7_attraction_many/_2_7_attraction_many.pde processingjs/chapter02/_2_7_attraction_many/Attractor.pde processingjs/chapter02/_2_7_attraction_many/Mover.pde" class="screenshot">
		<p>Your browser does not support the canvas tag.</p>
	</canvas>
	
	
</div>
<p><span class="example">Example 2.7: Attraction with many Movers</span></p>











<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>	
  <textarea>// Now we have 10 Movers!
Mover[] movers = new Mover[10];

Attractor a;

void setup() {
  size(400,400);
  for (int i = 0; i < movers.length; i++) {
    // Each Mover is initialized randomly
    movers[i] = new Mover(random(0.1,2),random(width),random(height));
  }
  a = new Attractor();
}

void draw() {
  background(255);

  a.display();

  for (int i = 0; i < movers.length; i++) {
    // We calculate an attraction force for each Mover object.
    PVector force = a.attract(movers[i]);
    movers[i].applyForce(force);

    movers[i].update();
    movers[i].display();
  }

}</textarea>
  
  
  
  <div class="code-block">
  <div class="code-comment-pair">
    <div class="code-comment-line"></div>
    <span class="code-comment">Now we have 10 Movers!</span>
    <code><pre><span class='one-line'><span class="n">Mover</span><span class="o">[]</span> <span class="n">movers</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Mover</span><span class="o">[</span><span class="mi">10</span><span class="o">];</span></span>

<span class='one-line'><span class="n">Attractor</span> <span class="n">a</span><span class="o">;</span></span>

<span class='one-line'><span class="kt">void</span> <span class="nf">setup</span><span class="o">()</span> <span class="o">{</span></span>
<span class='one-line'>  <span class="n">size</span><span class="o">(</span><span class="mi">400</span><span class="o">,</span><span class="mi">400</span><span class="o">);</span></span>
<span class='one-line'>  <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">movers</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span></span></pre></code>
  </div>
<div class="code-comment-pair">
    <div class="code-comment-line"></div>
    <span class="code-comment">Each Mover is initialized randomly</span>
    <code><pre><span class='one-line'>    <span class="n">movers</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Mover</span><span class="o">(</span><span class="n">random</span><span class="o">(</span><span class="mf">0.1</span><span class="o">,</span><span class="mi">2</span><span class="o">),</span><span class="n">random</span><span class="o">(</span><span class="n">width</span><span class="o">),</span><span class="n">random</span><span class="o">(</span><span class="n">height</span><span class="o">));</span></span>
<span class='one-line'>  <span class="o">}</span></span>
<span class='one-line'>  <span class="n">a</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Attractor</span><span class="o">();</span></span>
<span class='one-line'><span class="o">}</span></span>

<span class='one-line'><span class="kt">void</span> <span class="nf">draw</span><span class="o">()</span> <span class="o">{</span></span>
<span class='one-line'>  <span class="n">background</span><span class="o">(</span><span class="mi">255</span><span class="o">);</span></span>

<span class='one-line'>  <span class="n">a</span><span class="o">.</span><span class="na">display</span><span class="o">();</span></span>

<span class='one-line'>  <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">movers</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span></span></pre></code>
  </div>
<div class="code-comment-pair">
    <div class="code-comment-line"></div>
    <span class="code-comment">We calculate an attraction force for each Mover object.</span>
    <code><pre><span class='one-line'>    <span class="n">PVector</span> <span class="n">force</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="na">attract</span><span class="o">(</span><span class="n">movers</span><span class="o">[</span><span class="n">i</span><span class="o">]);</span></span>
<span class='one-line'>    <span class="n">movers</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">applyForce</span><span class="o">(</span><span class="n">force</span><span class="o">);</span></span>

<span class='one-line'>    <span class="n">movers</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">update</span><span class="o">();</span></span>
<span class='one-line'>    <span class="n">movers</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">display</span><span class="o">();</span></span>
<span class='one-line'>  <span class="o">}</span></span>

<span class='one-line'><span class="o">}</span></span></pre></code>
  </div>

</div>
</div>
<div class="example">
	<h3 id="exercise-29">Exercise 2.9</h3><p>In the example above, we have a system (i.e. array) of Mover objects and one Attractor object.  Build an example that has both systems of Movers and Attractors.  What if you make the Attractors invisible?  Can you create a pattern / design from the trails of objects moving around attractors?  (See the Metropop Denim project by Clayton Cubitt and Tom Carden: <a href="http://processing.org/exhibition/works/metropop/">
	http://processing.org/exhibition/works/metropop/
</a>
) for an example.)</p>

</div><div class="example">
	<h3 id="exercise-210">Exercise 2.10</h3><p>It’s worth noting that gravitational attraction is a model we can follow to develop our own forces.  This chapter isn’t suggesting that you should exclusively create sketches that use gravitational attraction.  Rather, you should be thinking creatively about how to design your own rules to drive the behavior of objects.  For example, what happens if you design a force that is weaker the closer it gets and stronger the farther it gets?  Or what if you design your attractor to attract far away objects, but repel close ones?</p>

</div><h2 id="210-everything-attracts-or-repels-everything">2.10 Everything Attracts (or Repels) Everything</h2>
<p>Hopefully, you found it helpful that we started with a simple scenario:  <em>one object attracts another object</em>, moving on to <em>one object attracts many objects</em>.  However, it’s likely that you are going to find yourself in a slightly more complex situation: <em>many objects attract each other</em>.  In other words, every object in a given system attracts every other object in that system (except for itself).</p>
<p>We’ve really done almost all of the work for this already.  Let’s consider a Processing sketch with an array of Mover objects:</p>











<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>	
  <textarea>Mover[] movers = new Mover[10];

void setup() {
  size(400,400);
  for (int i = 0; i < movers.length; i++) {
    movers[i] = new Mover(random(0.1,2),random(width),random(height));
  }
}

void draw() {
  background(255);
  for (int i = 0; i < movers.length; i++) {
    movers[i].update();
    movers[i].display();
  }
}</textarea>
  
  
  
  <div class="code-block">
  <div class="code-comment-pair">
    
    <span class="code-comment"></span>
    <code><pre><span class='one-line'><span class="n">Mover</span><span class="o">[]</span> <span class="n">movers</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Mover</span><span class="o">[</span><span class="mi">10</span><span class="o">];</span></span>

<span class='one-line'><span class="kt">void</span> <span class="nf">setup</span><span class="o">()</span> <span class="o">{</span></span>
<span class='one-line'>  <span class="n">size</span><span class="o">(</span><span class="mi">400</span><span class="o">,</span><span class="mi">400</span><span class="o">);</span></span>
<span class='one-line'>  <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">movers</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span></span>
<span class='one-line'>    <span class="n">movers</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Mover</span><span class="o">(</span><span class="n">random</span><span class="o">(</span><span class="mf">0.1</span><span class="o">,</span><span class="mi">2</span><span class="o">),</span><span class="n">random</span><span class="o">(</span><span class="n">width</span><span class="o">),</span><span class="n">random</span><span class="o">(</span><span class="n">height</span><span class="o">));</span></span>
<span class='one-line'>  <span class="o">}</span></span>
<span class='one-line'><span class="o">}</span></span>

<span class='one-line'><span class="kt">void</span> <span class="nf">draw</span><span class="o">()</span> <span class="o">{</span></span>
<span class='one-line'>  <span class="n">background</span><span class="o">(</span><span class="mi">255</span><span class="o">);</span></span>
<span class='one-line'>  <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">movers</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span></span>
<span class='one-line'>    <span class="n">movers</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">update</span><span class="o">();</span></span>
<span class='one-line'>    <span class="n">movers</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">display</span><span class="o">();</span></span>
<span class='one-line'>  <span class="o">}</span></span>
<span class='one-line'><span class="o">}</span></span></pre></code>
  </div>

</div>
</div>
<p>The <span class="function">draw()</span> function is where we need to work some magic.  Currently, we’re saying: “for every Mover i, update and display yourself.”  Now what we need to say is: “for every Mover i, be attracted to every other Mover j, and update and display yourself.”</p>
<p>To do this, we need to nest a second loop.</p>











<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>	
  <textarea> for (int i = 0; i < movers.length; i++) {
  // For every Mover, check every Mover!
    for (int j = 0; j < movers.length; j++) {
      PVector force = movers[j].attract(movers[i]);
      movers[i].applyForce(force);
    }
    movers[i].update();
    movers[i].display();
  }</textarea>
  
  
  
  <div class="code-block">
  <div class="code-comment-pair">
    
    <span class="code-comment"></span>
    <code><pre><span class='one-line'> <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">movers</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span></span></pre></code>
  </div>
<div class="code-comment-pair">
    <div class="code-comment-line"></div>
    <span class="code-comment">For every Mover, check every Mover!</span>
    <code><pre><span class='one-line'>    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">movers</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">j</span><span class="o">++)</span> <span class="o">{</span></span>
<span class='one-line'>      <span class="n">PVector</span> <span class="n">force</span> <span class="o">=</span> <span class="n">movers</span><span class="o">[</span><span class="n">j</span><span class="o">].</span><span class="na">attract</span><span class="o">(</span><span class="n">movers</span><span class="o">[</span><span class="n">i</span><span class="o">]);</span></span>
<span class='one-line'>      <span class="n">movers</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">applyForce</span><span class="o">(</span><span class="n">force</span><span class="o">);</span></span>
<span class='one-line'>    <span class="o">}</span></span>
<span class='one-line'>    <span class="n">movers</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">update</span><span class="o">();</span></span>
<span class='one-line'>    <span class="n">movers</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">display</span><span class="o">();</span></span>
<span class='one-line'>  <span class="o">}</span></span></pre></code>
  </div>

</div>
</div>
<p>In the previous example, we had an <span class="klass">Attractor</span> object with a function named <span class="function">attract()</span>.  Now, since we have <span class="klass">Movers</span> attracting <span class="klass">Movers</span>, all we need to do is copy the <span class="function">attract()</span> function into the <span class="klass">Mover</span> class.</p>











<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>	
  <textarea>class Mover {

  // all the other stuff we had before plus. . .

  // The Mover now knows how to attract another Mover.
  PVector attract(Mover m) {
    PVector force = PVector.sub(location,m.location);
    float distance = force.mag();
    distance = constrain(distance,5.0,25.0);
    force.normalize();

    float strength = (G * mass * m.mass) / (distance * distance);
    force.mult(strength);
    return force;
  }
}</textarea>
  
  
  
  <div class="code-block">
  <div class="code-comment-pair">
    
    <span class="code-comment"></span>
    <code><pre><span class='one-line'><span class="kd">class</span> <span class="nc">Mover</span> <span class="o">{</span></span></pre></code>
  </div>
<div class="code-comment-pair">
    <div class="code-comment-line"></div>
    <span class="code-comment">all the other stuff we had before plus. . .</span>
    <code><pre></pre></code>
  </div>
<div class="code-comment-pair">
    <div class="code-comment-line"></div>
    <span class="code-comment">The Mover now knows how to attract another Mover.</span>
    <code><pre><span class='one-line'>  <span class="n">PVector</span> <span class="nf">attract</span><span class="o">(</span><span class="n">Mover</span> <span class="n">m</span><span class="o">)</span> <span class="o">{</span></span>
<span class='one-line'>    <span class="n">PVector</span> <span class="n">force</span> <span class="o">=</span> <span class="n">PVector</span><span class="o">.</span><span class="na">sub</span><span class="o">(</span><span class="n">location</span><span class="o">,</span><span class="n">m</span><span class="o">.</span><span class="na">location</span><span class="o">);</span></span>
<span class='one-line'>    <span class="kt">float</span> <span class="n">distance</span> <span class="o">=</span> <span class="n">force</span><span class="o">.</span><span class="na">mag</span><span class="o">();</span></span>
<span class='one-line'>    <span class="n">distance</span> <span class="o">=</span> <span class="n">constrain</span><span class="o">(</span><span class="n">distance</span><span class="o">,</span><span class="mf">5.0</span><span class="o">,</span><span class="mf">25.0</span><span class="o">);</span></span>
<span class='one-line'>    <span class="n">force</span><span class="o">.</span><span class="na">normalize</span><span class="o">();</span></span>

<span class='one-line'>    <span class="kt">float</span> <span class="n">strength</span> <span class="o">=</span> <span class="o">(</span><span class="n">G</span> <span class="o">*</span> <span class="n">mass</span> <span class="o">*</span> <span class="n">m</span><span class="o">.</span><span class="na">mass</span><span class="o">)</span> <span class="o">/</span> <span class="o">(</span><span class="n">distance</span> <span class="o">*</span> <span class="n">distance</span><span class="o">);</span></span>
<span class='one-line'>    <span class="n">force</span><span class="o">.</span><span class="na">mult</span><span class="o">(</span><span class="n">strength</span><span class="o">);</span></span>
<span class='one-line'>    <span class="k">return</span> <span class="n">force</span><span class="o">;</span></span>
<span class='one-line'>  <span class="o">}</span></span>
<span class='one-line'><span class="o">}</span></span></pre></code>
  </div>

</div>
</div>
<p>Of course, there’s one small problem. When we are looking at every <span class="klass">Mover</span> <span class="var">i</span> and every  <span class="klass">Mover</span> <span class="var">j</span> , are we OK with the times that <span class="var">i</span> equals <span class="var">j</span>?  For example, should <span class="klass">Mover</span> #3 attract <span class="klass">Mover</span> #3?   The answer, of course, is no.   If there are five objects, we only want <span class="klass">Mover</span> #3 to attract 0, 1, 2, and 4, skipping itself.   And so, we finish this example by adding a simple conditional statement to skip applying the force when i equals j.</p>
<div class="image-container screenshot" >
	
	<canvas id="sketchdec21a" data-processing-sources="processingjs/chapter02/_2_8_mutual_attraction/_2_8_mutual_attraction.pde processingjs/chapter02/_2_8_mutual_attraction/Mover.pde" class="screenshot">
		<p>Your browser does not support the canvas tag.</p>
	</canvas>
	
	
</div>
<p><span class="example">Example 2.8: Mutual Attraction</span></p>











<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>	
  <textarea>Mover[] movers = new Mover[20];

float g = 0.4;

void setup() {
  size(400,400);
  for (int i = 0; i < movers.length; i++) {
    movers[i] = new Mover(random(0.1,2),random(width),random(height));
  }
}

void draw() {
  background(255);

  for (int i = 0; i < movers.length; i++) {
    for (int j = 0; j < movers.length; j++) {
      // Don’t attract yourself!
      if (i != j) {
        PVector force = movers[j].attract(movers[i]);
        movers[i].applyForce(force);
      }
    }
    movers[i].update();
    movers[i].display();
  }
}</textarea>
  
  
  
  <div class="code-block">
  <div class="code-comment-pair">
    
    <span class="code-comment"></span>
    <code><pre><span class='one-line'><span class="n">Mover</span><span class="o">[]</span> <span class="n">movers</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Mover</span><span class="o">[</span><span class="mi">20</span><span class="o">];</span></span>

<span class='one-line'><span class="kt">float</span> <span class="n">g</span> <span class="o">=</span> <span class="mf">0.4</span><span class="o">;</span></span>

<span class='one-line'><span class="kt">void</span> <span class="nf">setup</span><span class="o">()</span> <span class="o">{</span></span>
<span class='one-line'>  <span class="n">size</span><span class="o">(</span><span class="mi">400</span><span class="o">,</span><span class="mi">400</span><span class="o">);</span></span>
<span class='one-line'>  <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">movers</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span></span>
<span class='one-line'>    <span class="n">movers</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Mover</span><span class="o">(</span><span class="n">random</span><span class="o">(</span><span class="mf">0.1</span><span class="o">,</span><span class="mi">2</span><span class="o">),</span><span class="n">random</span><span class="o">(</span><span class="n">width</span><span class="o">),</span><span class="n">random</span><span class="o">(</span><span class="n">height</span><span class="o">));</span></span>
<span class='one-line'>  <span class="o">}</span></span>
<span class='one-line'><span class="o">}</span></span>

<span class='one-line'><span class="kt">void</span> <span class="nf">draw</span><span class="o">()</span> <span class="o">{</span></span>
<span class='one-line'>  <span class="n">background</span><span class="o">(</span><span class="mi">255</span><span class="o">);</span></span>

<span class='one-line'>  <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">movers</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span></span>
<span class='one-line'>    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">movers</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">j</span><span class="o">++)</span> <span class="o">{</span></span></pre></code>
  </div>
<div class="code-comment-pair">
    <div class="code-comment-line"></div>
    <span class="code-comment">Don’t attract yourself!</span>
    <code><pre><span class='one-line'>      <span class="k">if</span> <span class="o">(</span><span class="n">i</span> <span class="o">!=</span> <span class="n">j</span><span class="o">)</span> <span class="o">{</span></span>
<span class='one-line'>        <span class="n">PVector</span> <span class="n">force</span> <span class="o">=</span> <span class="n">movers</span><span class="o">[</span><span class="n">j</span><span class="o">].</span><span class="na">attract</span><span class="o">(</span><span class="n">movers</span><span class="o">[</span><span class="n">i</span><span class="o">]);</span></span>
<span class='one-line'>        <span class="n">movers</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">applyForce</span><span class="o">(</span><span class="n">force</span><span class="o">);</span></span>
<span class='one-line'>      <span class="o">}</span></span>
<span class='one-line'>    <span class="o">}</span></span>
<span class='one-line'>    <span class="n">movers</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">update</span><span class="o">();</span></span>
<span class='one-line'>    <span class="n">movers</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">display</span><span class="o">();</span></span>
<span class='one-line'>  <span class="o">}</span></span>
<span class='one-line'><span class="o">}</span></span></pre></code>
  </div>

</div>
</div>
<div class="example">
	<h3 id="exercise-211">Exercise 2.11</h3><p>Change the attraction force in Example 2.x to a repulsion force.  Can you create an example where all of the Mover objects are attracted to the mouse, but repel each other?  Think about how you need to balance the relative strength of the forces and how to most effectively use distance in your force calculations.</p>

</div><div class="tip">
	<h3 id="the-ecosystem-project">The Ecosystem Project:</h3><p>Step 2 Exercise:</p>
<p>Incorporate the concept of forces into your ecosystem.   Try introducing other elements into the environment (food, a predator) that the creature interacts with.   Does the creature experience attraction or repulsion to things in its world?  Can you think more abstractly and design forces based on the creature’s desires or goals?</p>

</div>
	</div>
</body>
</html>